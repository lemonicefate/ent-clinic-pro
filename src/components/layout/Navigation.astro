---
/**
 * 主要導覽組件
 * 提供醫療平台的主要導覽選單
 */

export interface Props {
  locale?: 'zh-TW' | 'en' | 'ja';
  mobile?: boolean;
}

const { locale = 'zh-TW', mobile = false } = Astro.props;

// 多語言導覽項目
const navigationItems = {
  'zh-TW': [
    {
      label: '首頁',
      href: '/',
      icon: 'home',
      description: '回到首頁'
    },
    {
      label: '醫療工具',
      href: '/tools',
      icon: 'calculator',
      description: '臨床計算機和決策工具',
      children: [
        { label: '計算機總覽', href: '/tools' },
        { label: '心臟科工具', href: '/tools/cardiology' },
        { label: '神經科工具', href: '/tools/neurology' },
        { label: '急診工具', href: '/tools/emergency' },
        { label: '一般醫學工具', href: '/tools/general' }
      ]
    },
    {
      label: '衛教資源',
      href: '/education',
      icon: 'book',
      description: '病患衛教和醫療資訊',
      children: [
        { label: '衛教文章', href: '/education' },
        { label: '疾病資訊', href: '/education/diseases' },
        { label: '藥物資訊', href: '/education/medications' },
        { label: '檢查程序', href: '/education/procedures' },
        { label: '預防保健', href: '/education/prevention' }
      ]
    },

    {
      label: '專科分類',
      href: '/specialties',
      icon: 'medical',
      description: '按醫療專科瀏覽內容'
    },
    {
      label: '關於我們',
      href: '/about',
      icon: 'info',
      description: '平台介紹和使用說明'
    }
  ],
  'en': [
    {
      label: 'Home',
      href: '/en',
      icon: 'home',
      description: 'Back to homepage'
    },
    {
      label: 'Medical Tools',
      href: '/en/tools',
      icon: 'calculator',
      description: 'Clinical calculators and decision tools',
      children: [
        { label: 'All Tools', href: '/en/tools' },
        { label: 'Cardiology Tools', href: '/en/tools/cardiology' },
        { label: 'Neurology Tools', href: '/en/tools/neurology' },
        { label: 'Emergency Tools', href: '/en/tools/emergency' },
        { label: 'General Medicine', href: '/en/tools/general' }
      ]
    },
    {
      label: 'Education',
      href: '/en/education',
      icon: 'book',
      description: 'Patient education and medical information',
      children: [
        { label: 'All Articles', href: '/en/education' },
        { label: 'Disease Information', href: '/en/education/diseases' },
        { label: 'Medication Guide', href: '/en/education/medications' },
        { label: 'Procedures', href: '/en/education/procedures' },
        { label: 'Prevention', href: '/en/education/prevention' }
      ]
    },

    {
      label: 'Specialties',
      href: '/en/specialties',
      icon: 'medical',
      description: 'Browse content by medical specialty'
    },
    {
      label: 'About',
      href: '/en/about',
      icon: 'info',
      description: 'Platform introduction and usage guide'
    }
  ],
  'ja': [
    {
      label: 'ホーム',
      href: '/ja',
      icon: 'home',
      description: 'ホームページに戻る'
    },
    {
      label: '医療ツール',
      href: '/ja/tools',
      icon: 'calculator',
      description: '臨床計算機と決定ツール',
      children: [
        { label: 'すべてのツール', href: '/ja/tools' },
        { label: '循環器科ツール', href: '/ja/tools/cardiology' },
        { label: '神経科ツール', href: '/ja/tools/neurology' },
        { label: '救急ツール', href: '/ja/tools/emergency' },
        { label: '一般内科', href: '/ja/tools/general' }
      ]
    },
    {
      label: '教育リソース',
      href: '/ja/education',
      icon: 'book',
      description: '患者教育と医療情報',
      children: [
        { label: 'すべての記事', href: '/ja/education' },
        { label: '疾患情報', href: '/ja/education/diseases' },
        { label: '薬物情報', href: '/ja/education/medications' },
        { label: '検査手順', href: '/ja/education/procedures' },
        { label: '予防', href: '/ja/education/prevention' }
      ]
    },

    {
      label: '専門科',
      href: '/ja/specialties',
      icon: 'medical',
      description: '医療専門科別にコンテンツを閲覧'
    },
    {
      label: '私たちについて',
      href: '/ja/about',
      icon: 'info',
      description: 'プラットフォーム紹介と使用ガイド'
    }
  ]
};

const navItems = navigationItems[locale];

// 圖示組件
const getIcon = (iconName: string) => {
  const icons = {
    home: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />',
    calculator: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />',
    book: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />',
    flow: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />',
    tree: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8a2 2 0 012-2h10a2 2 0 012 2v10a2 2 0 01-2 2H7a2 2 0 01-2-2V8z M9 12l2 2 4-4" />',
    medical: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />',
    info: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />'
  };
  return icons[iconName] || icons.info;
};

// 獲取當前路徑
const currentPath = Astro.url.pathname;
---

<nav 
  role="navigation" 
  aria-label="主要導覽"
  class={mobile ? 'mobile-navigation' : 'desktop-navigation'}
>
  <ul class={mobile 
    ? 'flex flex-col space-y-2' 
    : 'flex items-center space-x-1 xl:space-x-2'
  }>
    {navItems.map((item) => (
      <li class="relative group">
        <!-- 主要導覽項目 -->
        <a
          href={item.href}
          class={`
            flex items-center space-x-2 px-3 py-2 rounded-lg text-sm font-medium transition-all duration-200
            ${mobile 
              ? 'w-full hover:bg-medical-neutral-100 focus:bg-medical-neutral-100' 
              : 'hover:bg-medical-primary-50 hover:text-medical-primary-700 focus:bg-medical-primary-50 focus:text-medical-primary-700'
            }
            ${currentPath === item.href || currentPath.startsWith(item.href + '/')
              ? mobile 
                ? 'bg-medical-primary-100 text-medical-primary-800 border-l-4 border-medical-primary-600'
                : 'bg-medical-primary-100 text-medical-primary-800'
              : mobile
                ? 'text-medical-neutral-700 hover:text-medical-neutral-900'
                : 'text-medical-neutral-600 hover:text-medical-neutral-800'
            }
            focus:outline-none focus:ring-2 focus:ring-medical-primary-500 focus:ring-offset-2
          `}
          aria-describedby={`nav-desc-${item.label}`}
        >
          <!-- 圖示 -->
          <svg class="h-5 w-5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <Fragment set:html={getIcon(item.icon)} />
          </svg>
          
          <!-- 標籤 -->
          <span class="whitespace-nowrap">{item.label}</span>
          
          <!-- 下拉箭頭 (如果有子選單) -->
          {item.children && !mobile && (
            <svg class="h-4 w-4 ml-1 transition-transform group-hover:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          )}
        </a>
        
        <!-- 隱藏的描述 (無障礙) -->
        <span id={`nav-desc-${item.label}`} class="sr-only">
          {item.description}
        </span>
        
        <!-- 桌面版下拉選單 -->
        {item.children && !mobile && (
          <div class="absolute left-0 top-full mt-1 w-56 bg-white rounded-lg shadow-lg border border-medical-neutral-200 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
            <div class="py-2">
              {item.children.map((child) => (
                <a
                  href={child.href}
                  class={`
                    block px-4 py-2 text-sm transition-colors
                    ${currentPath === child.href
                      ? 'bg-medical-primary-50 text-medical-primary-700 border-r-2 border-medical-primary-600'
                      : 'text-medical-neutral-600 hover:bg-medical-neutral-50 hover:text-medical-neutral-800'
                    }
                    focus:outline-none focus:bg-medical-primary-50 focus:text-medical-primary-700
                  `}
                >
                  {child.label}
                </a>
              ))}
            </div>
          </div>
        )}
        
        <!-- 行動版子選單 -->
        {item.children && mobile && (
          <div class="ml-6 mt-2 space-y-1">
            {item.children.map((child) => (
              <a
                href={child.href}
                class={`
                  block px-3 py-2 text-sm rounded-md transition-colors
                  ${currentPath === child.href
                    ? 'bg-medical-primary-50 text-medical-primary-700'
                    : 'text-medical-neutral-600 hover:bg-medical-neutral-50 hover:text-medical-neutral-800'
                  }
                  focus:outline-none focus:bg-medical-primary-50 focus:text-medical-primary-700
                `}
              >
                {child.label}
              </a>
            ))}
          </div>
        )}
      </li>
    ))}
  </ul>
</nav>

<style>
  /* 桌面版導覽樣式 */
  .desktop-navigation {
    /* 下拉選單動畫 */
  }
  
  .desktop-navigation .group:hover .absolute {
    animation: slideDown 0.2s ease-out;
  }
  
  @keyframes slideDown {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  /* 行動版導覽樣式 */
  .mobile-navigation {
    /* 確保在小螢幕上的可讀性 */
  }
  
  /* 高對比模式支援 */
  @media (prefers-contrast: high) {
    .desktop-navigation a,
    .mobile-navigation a {
      border: 1px solid transparent;
    }
    
    .desktop-navigation a:hover,
    .desktop-navigation a:focus,
    .mobile-navigation a:hover,
    .mobile-navigation a:focus {
      border-color: currentColor;
    }
  }
  
  /* 減少動畫偏好 */
  @media (prefers-reduced-motion: reduce) {
    .desktop-navigation .absolute {
      transition: none;
    }
    
    @keyframes slideDown {
      from, to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  }
  
  /* 確保下拉選單在小螢幕上不會超出邊界 */
  @media (max-width: 1024px) {
    .desktop-navigation .absolute {
      left: auto;
      right: 0;
    }
  }
</style>