# ÈÜ´ÁôÇË®àÁÆóÂô®ÈñãÁôºÊ®ôÊ∫ñ‰ΩúÊ•≠Á®ãÂ∫è (SOP)

## üìã Ê¶ÇËø∞

Êú¨ÊñáÊ™îÊèê‰æõ‰∫ÜÂú® Astro Clinical Platform ‰∏≠Êñ∞Â¢ûÈÜ´ÁôÇË®àÁÆóÂô®ÁöÑÂÆåÊï¥Ê®ôÊ∫ñ‰ΩúÊ•≠Á®ãÂ∫èÔºåÂü∫ÊñºÊúÄÊñ∞ÁöÑÂ∞àÁßëÂàÜÈ°ûÁµêÊßãÔºåÂåÖÊã¨ÊâÄÈúÄÊñá‰ª∂„ÄÅÈñãÁôºÊµÅÁ®ã„ÄÅÈ©óË≠âÊ≠•È©üÂíåÂ∏∏Ë¶ãÈåØË™§È†êÈò≤„ÄÇ

## üè• Â∞àÁßëÂàÜÈ°ûÁ≥ªÁµ±

Âπ≥Âè∞Êé°Áî®ÈÜ´ÁôÇÂ∞àÁßëÂàÜÈ°ûÁ≥ªÁµ±‰æÜÁµÑÁπîË®àÁÆóÂô®ÔºåÁõÆÂâçÊîØÊè¥ÁöÑÂ∞àÁßëÂåÖÊã¨Ôºö

- **‰∏ÄËà¨ÈÜ´Â≠∏** (general) üè• - Âü∫Á§éÂÅ•Â∫∑Ë©ï‰º∞ÂíåÂ∏∏Ë¶ãÈÜ´ÁôÇÊåáÊ®ô
- **ÂøÉËáüÁßë** (cardiology) ‚ù§Ô∏è - ÂøÉË°ÄÁÆ°ÁñæÁóÖÈ¢®Èö™Ë©ï‰º∞ÂíåË®∫Êñ∑ËºîÂä©
- **ËÖéËáüÁßë** (nephrology) ü´ò - ËÖéÂäüËÉΩË©ï‰º∞ÂíåÊÖ¢ÊÄßËÖéÁóÖÁÆ°ÁêÜ
- **Â∞èÂÖíÁßë** (pediatrics) üë∂ - ÂÖíÁ´•ÈÜ´ÁôÇÂäëÈáèË®àÁÆóÂíåÁîüÈï∑ÁôºËÇ≤Ë©ï‰º∞
- **ÂÖßÂàÜÊ≥åÁßë** (endocrinology) ü©∫ - ÂÖßÂàÜÊ≥åÁñæÁóÖË®∫Êñ∑Âíå‰ª£Ë¨ùË©ï‰º∞
- **ÊÄ•Ë®∫Áßë** (emergency) üö® - ÊÄ•Ë®∫ÈÜ´ÁôÇË©ï‰º∞ÂíåÁ∑äÊÄ•ËôïÁΩÆ
- **ÂÖßÁßë** (internal-medicine) üè• - ÂÖßÁßëÁñæÁóÖË®∫Êñ∑ÂíåÊ≤ªÁôÇË©ï‰º∞
- **Â§ñÁßë** (surgery) üî™ - Â§ñÁßëÊâãË°ìÈ¢®Èö™Ë©ï‰º∞ÂíåË°ìÂâçË©ï‰º∞
- **Â©¶Áî¢Áßë** (obstetrics-gynecology) ü§± - Â©¶Áî¢ÁßëÈÜ´ÁôÇË©ï‰º∞ÂíåÂ≠ïÊúüË®àÁÆó
- **Á≤æÁ•ûÁßë** (psychiatry) üß† - Á≤æÁ•ûÁñæÁóÖË©ï‰º∞ÂíåÂøÉÁêÜÂÅ•Â∫∑ÁØ©Ê™¢
- **ÁöÆËÜöÁßë** (dermatology) ü©¥ - ÁöÆËÜöÁñæÁóÖË®∫Êñ∑ÂíåÊ≤ªÁôÇË©ï‰º∞

## üèóÔ∏è Êû∂ÊßãÊ¶ÇË¶Ω

### Ê†∏ÂøÉÁµÑ‰ª∂

- **PluginCalculator.tsx**: ÈÄöÁî®Ë®àÁÆóÂô®Â≥∂ÁµÑ‰ª∂
- **Ë®àÁÆóÂô®Êèí‰ª∂**: Áç®Á´ãÁöÑË®àÁÆóÂô®ÂØ¶Áèæ
- **È†ÅÈù¢ÁµÑ‰ª∂**: Astro È†ÅÈù¢Êñá‰ª∂
- **ÈÖçÁΩÆÊñá‰ª∂**: JSON ÈÖçÁΩÆÂíåÈ°ûÂûãÂÆöÁæ©

### ÁõÆÈåÑÁµêÊßã

```
src/
‚îú‚îÄ‚îÄ calculators/
‚îÇ   ‚îî‚îÄ‚îÄ specialties/             # Â∞àÁßëÂàÜÈ°ûÊ†πÁõÆÈåÑ
‚îÇ       ‚îî‚îÄ‚îÄ {specialty}/         # ÈÜ´ÁôÇÂ∞àÁßë (Â¶Ç cardiology, nephrology)
‚îÇ           ‚îî‚îÄ‚îÄ {calculator-id}/ # Ë®àÁÆóÂô®ID
‚îÇ               ‚îú‚îÄ‚îÄ __tests__/   # Ê∏¨Ë©¶Êñá‰ª∂ (ÂèØÈÅ∏)
‚îÇ               ‚îú‚îÄ‚îÄ index.ts     # Êèí‰ª∂ÂÖ•Âè£Èªû
‚îÇ               ‚îú‚îÄ‚îÄ calculator.ts # Ë®àÁÆóÈÇèËºØ
‚îÇ               ‚îú‚îÄ‚îÄ config.json  # ÈÖçÁΩÆÊñá‰ª∂
‚îÇ               ‚îú‚îÄ‚îÄ Dashboard.tsx # ÁµêÊûúÈ°ØÁ§∫ÁµÑ‰ª∂
‚îÇ               ‚îî‚îÄ‚îÄ visualization.json # ÂèØË¶ñÂåñÈÖçÁΩÆ
‚îú‚îÄ‚îÄ pages/tools/
‚îÇ   ‚îú‚îÄ‚îÄ index.astro              # Â∑•ÂÖ∑Á∏ΩË¶ΩÈ†ÅÈù¢
‚îÇ   ‚îî‚îÄ‚îÄ {calculator-id}.astro    # Ë®àÁÆóÂô®Â∞àÁî®È†ÅÈù¢
‚îú‚îÄ‚îÄ components/islands/
‚îÇ   ‚îî‚îÄ‚îÄ PluginCalculator.tsx    # ÈÄöÁî®Ë®àÁÆóÂô®ÁµÑ‰ª∂
‚îî‚îÄ‚îÄ types/
    ‚îú‚îÄ‚îÄ calculator.ts            # Ë®àÁÆóÂô®È°ûÂûãÂÆöÁæ©
    ‚îî‚îÄ‚îÄ calculator-plugin.ts     # Êèí‰ª∂È°ûÂûãÂÆöÁæ©
```

## üöÄ ÈñãÁôºÊµÅÁ®ã

### Á¨¨‰∏ÄÊ≠•ÔºöË¶èÂäÉÂíåË®≠Ë®à

#### 1.1 Á¢∫ÂÆöË®àÁÆóÂô®Âü∫Êú¨‰ø°ÊÅØ

- [ ] **Ë®àÁÆóÂô®ID**: ‰ΩøÁî® kebab-caseÔºåÂ¶Ç `has-bled`
- [ ] **ÈÜ´ÁôÇÂ∞àÁßë**: ÈÅ∏ÊìáÈÅ©Áï∂ÁöÑÈÜ´Â≠∏Â∞àÁßëÂàÜÈ°ûÔºö
  - `general` - ‰∏ÄËà¨ÈÜ´Â≠∏ üè•
  - `cardiology` - ÂøÉËáüÁßë ‚ù§Ô∏è
  - `nephrology` - ËÖéËáüÁßë ü´ò
  - `pediatrics` - Â∞èÂÖíÁßë üë∂
  - `endocrinology` - ÂÖßÂàÜÊ≥åÁßë ü©∫
  - `emergency` - ÊÄ•Ë®∫Áßë üö®
  - `internal-medicine` - ÂÖßÁßë üè•
  - `surgery` - Â§ñÁßë üî™
  - `obstetrics-gynecology` - Â©¶Áî¢Áßë ü§±
  - `psychiatry` - Á≤æÁ•ûÁßë üß†
  - `dermatology` - ÁöÆËÜöÁßë ü©¥
- [ ] **ÁâàÊú¨Ëôü**: ÈÅµÂæ™Ë™ûÁæ©ÂåñÁâàÊú¨ÔºåÂ¶Ç `1.0.0`
- [ ] **Â§öË™ûË®ÄÂêçÁ®±**: Êèê‰æõ zh-TW, en ÂÖ©Á®ÆË™ûË®Ä
- [ ] **ÊèèËø∞**: Á∞°ÊΩîÊòéÁ¢∫ÁöÑÂäüËÉΩÊèèËø∞

#### 1.2 ÂÆöÁæ©Ëº∏ÂÖ•Â≠óÊÆµ

- [ ] **Â≠óÊÆµÈ°ûÂûã**: `number`, `select`, `checkbox`, `text`
- [ ] **È©óË≠âË¶èÂâá**: ÊúÄÂ∞èÂÄº„ÄÅÊúÄÂ§ßÂÄº„ÄÅÂøÖÂ°´È†Ö
- [ ] **ÂñÆ‰Ωç**: ÊòéÁ¢∫Ê®ôÁ§∫ÂñÆ‰ΩçÔºàÂ¶Ç kg, cm, mg/dLÔºâ
- [ ] **Âπ´Âä©ÊñáÊú¨**: Êèê‰æõ‰ΩøÁî®ÊåáÂ∞é

#### 1.3 Ë®≠Ë®àË®àÁÆóÈÇèËºØ

- [ ] **ÂÖ¨Âºè**: Á¢∫Ë™çÈÜ´Â≠∏ÂÖ¨ÂºèÁöÑÊ∫ñÁ¢∫ÊÄß
- [ ] **ÂèÉËÄÉÊñáÁçª**: Êî∂ÈõÜÊ¨äÂ®ÅÈÜ´Â≠∏ÊåáÂºï
- [ ] **ÁµêÊûúËß£Èáã**: ÂÆöÁæ©È¢®Èö™Á≠âÁ¥öÂíåÂª∫Ë≠∞

### Á¨¨‰∫åÊ≠•ÔºöÂâµÂª∫Êñá‰ª∂ÁµêÊßã

#### 2.1 ÂâµÂª∫Ë®àÁÆóÂô®ÁõÆÈåÑ

```bash
mkdir -p src/calculators/specialties/{specialty}/{calculator-id}
mkdir -p src/calculators/specialties/{specialty}/{calculator-id}/__tests__
```

#### 2.2 ÂâµÂª∫ÂøÖË¶ÅÊñá‰ª∂

- [ ] `config.json` - ÈÖçÁΩÆÊñá‰ª∂
- [ ] `calculator.ts` - Ë®àÁÆóÈÇèËºØ
- [ ] `index.ts` - Êèí‰ª∂ÂÖ•Âè£Èªû
- [ ] `{CalculatorName}Dashboard.tsx` - ÁµêÊûúÈ°ØÁ§∫ÁµÑ‰ª∂
- [ ] `visualization.json` - ÂèØË¶ñÂåñÈÖçÁΩÆ
- [ ] `__tests__/calculator.test.ts` - Ê∏¨Ë©¶Êñá‰ª∂ (Êé®Ëñ¶)

### Á¨¨‰∏âÊ≠•ÔºöÂØ¶ÁèæÈÖçÁΩÆÊñá‰ª∂ (config.json)

```json
{
  "id": "calculator-id",
  "version": "1.0.0",
  "name": {
    "zh-TW": "Ë®àÁÆóÂô®‰∏≠ÊñáÂêçÁ®±",
    "en": "Calculator English Name",
    "ja": "Ë®àÁÆóÂô®Êó•ÊñáÂêçÁ®±"
  },
  "description": {
    "zh-TW": "‰∏≠ÊñáÊèèËø∞",
    "en": "English description",
    "ja": "Êó•ÊñáÊèèËø∞"
  },
  "category": "specialty",
  "metadata": {
    "difficulty": "basic|intermediate|advanced",
    "tags": ["tag1", "tag2"],
    "author": "Astro Clinical Platform",
    "license": "MIT"
  },
  "medical": {
    "specialty": ["Â∞àÁßë1", "Â∞àÁßë2"],
    "evidenceLevel": "A|B|C",
    "clinicalGuidelines": {
      "zh-TW": "Ëá®Â∫äÊåáÂºïË™™Êòé",
      "en": "Clinical guidelines",
      "ja": "Ëá®Â∫ä„Ç¨„Ç§„Éâ„É©„Ç§„É≥"
    }
  },
  "ui": {
    "fields": [
      {
        "id": "field-id",
        "type": "number|select|checkbox|text",
        "label": {
          "zh-TW": "Â≠óÊÆµÊ®ôÁ±§",
          "en": "Field Label",
          "ja": "„Éï„Ç£„Éº„É´„Éâ„É©„Éô„É´"
        },
        "required": true,
        "validation": {
          "min": 0,
          "max": 100
        },
        "unit": {
          "zh-TW": "ÂñÆ‰Ωç",
          "en": "unit",
          "ja": "Âçò‰Ωç"
        }
      }
    ]
  }
}
```

### Á¨¨ÂõõÊ≠•ÔºöÂØ¶ÁèæË®àÁÆóÈÇèËºØ (calculator.ts)

```typescript
import type {
  CalculatorInputs,
  CalculationResult,
  ValidationResult,
  SupportedLocale,
} from '../../../../types/calculator.js';

/**
 * ‰∏ªË¶ÅË®àÁÆóÂáΩÊï∏
 */
export function calculate(inputs: CalculatorInputs): CalculationResult {
  // 1. Ëº∏ÂÖ•È©óË≠â
  const validation = validate(inputs);
  if (!validation.isValid) {
    throw new Error('Invalid inputs');
  }

  // 2. Âü∑Ë°åË®àÁÆó
  const result = performCalculation(inputs);

  // 3. ËøîÂõûÁµêÊûú
  return {
    primaryValue: result.value,
    primaryUnit: result.unit,
    secondaryValues: result.additional,
    interpretation: {
      'zh-TW': '‰∏≠ÊñáËß£Èáã',
      en: 'English interpretation',
      ja: 'Êó•Êú¨Ë™û„ÅÆËß£Èáà',
    },
    recommendations: generateRecommendations(result),
    riskLevel: determineRiskLevel(result.value),
    metadata: {
      calculationSteps: result.steps,
      references: ['ÂèÉËÄÉÊñáÁçª1', 'ÂèÉËÄÉÊñáÁçª2'],
      lastCalculated: new Date().toISOString(),
    },
  };
}

/**
 * Ëº∏ÂÖ•È©óË≠âÂáΩÊï∏
 */
export function validate(inputs: CalculatorInputs): ValidationResult {
  const errors = [];

  // È©óË≠âÊØèÂÄãÂøÖÂ°´Â≠óÊÆµ
  // È©óË≠âÊï∏ÂÄºÁØÑÂúç
  // È©óË≠âÊ†ºÂºè

  return {
    isValid: errors.length === 0,
    errors,
  };
}

/**
 * Ê†ºÂºèÂåñÁµêÊûúÂáΩÊï∏
 */
export function formatResult(
  result: CalculationResult,
  locale: SupportedLocale = 'zh-TW'
) {
  return {
    displayValue: `${result.primaryValue} ${result.primaryUnit}`,
    description: result.interpretation?.[locale] || '',
    recommendations:
      result.recommendations?.map((rec) => rec[locale] || rec['zh-TW'] || '') ||
      [],
  };
}
```

### Á¨¨‰∫îÊ≠•ÔºöÂâµÂª∫ÁµêÊûúÈ°ØÁ§∫ÁµÑ‰ª∂ (Dashboard.tsx)

```typescript
import React from 'react';
import type { CalculationResult } from '../../../../types/calculator.js';
import type { SupportedLocale } from '../../../../types/calculator-plugin.js';

interface DashboardProps {
  result: CalculationResult;
  locale?: SupportedLocale;
  onRetry?: () => void;
}

export default function Dashboard({
  result,
  locale = 'zh-TW',
  onRetry
}: DashboardProps) {
  return (
    <div className="space-y-6">
      {/* ‰∏ªË¶ÅÁµêÊûúÈ°ØÁ§∫ */}
      <div className="rounded-lg border-2 p-6">
        <div className="text-center">
          <div className="text-4xl font-bold mb-2">
            {result.primaryValue} {result.primaryUnit}
          </div>
          <div className="text-lg">
            {result.interpretation?.[locale]}
          </div>
        </div>
      </div>

      {/* Âª∫Ë≠∞‰∫ãÈ†Ö */}
      {result.recommendations && (
        <div className="bg-white rounded-lg border p-6">
          <h3 className="text-lg font-semibold mb-4">Ëá®Â∫äÂª∫Ë≠∞</h3>
          <ul className="space-y-2">
            {result.recommendations.map((rec, index) => (
              <li key={index} className="flex items-start space-x-3">
                <span className="flex-shrink-0 w-2 h-2 bg-blue-600 rounded-full mt-2"></span>
                <span>{rec[locale] || rec['zh-TW']}</span>
              </li>
            ))}
          </ul>
        </div>
      )}
    </div>
  );
}
```

### Á¨¨ÂÖ≠Ê≠•ÔºöÂâµÂª∫Êèí‰ª∂ÂÖ•Âè£ (index.ts)

```typescript
import type { CalculatorPlugin } from '../../../../types/calculator-plugin.js';
import { calculate, validate, formatResult } from './calculator.js';
import Dashboard from './{CalculatorName}Dashboard.tsx';
import config from './config.json';

const CalculatorPlugin: CalculatorPlugin = {
  metadata: {
    id: config.id,
    namespace: 'specialty',
    version: config.version,
    name: config.name,
    description: config.description,
    author: config.metadata.author,
    license: config.metadata.license,
    tags: config.metadata.tags,
    createdAt: new Date().toISOString(),
    updatedAt: config.metadata.lastUpdated || new Date().toISOString(),
  },

  config: {
    id: config.id,
    name: config.name,
    description: config.description,
    category: config.category,
    version: config.version,
    status: 'active',
    fields: config.ui.fields,
    medical: config.medical,
    metadata: config.metadata,
  },

  calculator: {
    calculate,
    validate,
    formatResult,
  },

  dashboard: Dashboard,

  async install() {
    console.log(`üì¶ Installing ${config.name['zh-TW']} Plugin...`);
    // ÂÆâË£ùÈÇèËºØ
  },

  async uninstall() {
    console.log(`üóëÔ∏è Uninstalling ${config.name['zh-TW']} Plugin...`);
    // Âç∏ËºâÈÇèËºØ
  },

  async validate() {
    // È©óË≠âÈÇèËºØ
    return true;
  },

  async checkCompatibility() {
    return {
      compatible: true,
      issues: [],
    };
  },
};

export default CalculatorPlugin;
```

### Á¨¨‰∏ÉÊ≠•ÔºöÂâµÂª∫ÂèØË¶ñÂåñÈÖçÁΩÆ (visualization.json)

```json
{
  "id": "calculator-id",
  "name": {
    "zh-TW": "Ë®àÁÆóÂô®ÂêçÁ®±",
    "en": "Calculator Name"
  },
  "description": {
    "zh-TW": "Ë®àÁÆóÂô®ÊèèËø∞",
    "en": "Calculator Description"
  },
  "category": "specialty",
  "version": "1.0.0",
  "charts": [
    {
      "type": "gauge",
      "title": {
        "zh-TW": "È¢®Èö™Á≠âÁ¥ö",
        "en": "Risk Level"
      },
      "config": {
        "min": 0,
        "max": 100,
        "thresholds": [
          {
            "value": 30,
            "color": "green",
            "label": { "zh-TW": "‰ΩéÈ¢®Èö™", "en": "Low Risk" }
          },
          {
            "value": 70,
            "color": "yellow",
            "label": { "zh-TW": "‰∏≠È¢®Èö™", "en": "Medium Risk" }
          },
          {
            "value": 100,
            "color": "red",
            "label": { "zh-TW": "È´òÈ¢®Èö™", "en": "High Risk" }
          }
        ]
      }
    }
  ],
  "resultDisplay": {
    "primaryValue": {
      "format": "number",
      "precision": 1,
      "unit": {
        "zh-TW": "ÂàÜ",
        "en": "points"
      }
    },
    "interpretation": {
      "showRiskLevel": true,
      "showRecommendations": true,
      "showCalculationSteps": false
    }
  },
  "metadata": {
    "lastUpdated": "2024-01-15T00:00:00.000Z",
    "author": "Astro Clinical Platform"
  }
}
```

### Á¨¨‰∏ÉÊ≠•ÔºöÂâµÂª∫Â∞àÁî®È†ÅÈù¢

#### 7.1 ÂâµÂª∫È†ÅÈù¢Êñá‰ª∂ (`src/pages/tools/{calculator-id}.astro`)

```astro
---
import BaseLayout from '../../layouts/BaseLayout.astro';
import PluginCalculator from '../../components/islands/PluginCalculator.tsx';
import type { SupportedLocale } from '../../types/calculator.js';

const locale: SupportedLocale = 'zh-TW';

const pluginMetadata = {
  id: 'calculator-id',
  namespace: 'specialty',
  version: '1.0.0',
  name: {
    'zh-TW': 'Ë®àÁÆóÂô®ÂêçÁ®±',
    en: 'Calculator Name',
  },
  description: {
    'zh-TW': 'Ë®àÁÆóÂô®ÊèèËø∞',
    en: 'Calculator Description',
  },
};

const breadcrumbs = [
  { label: 'È¶ñÈ†Å', href: '/' },
  { label: 'ÈÜ´ÁôÇÂ∑•ÂÖ∑', href: '/tools' },
  { label: pluginMetadata.name[locale] },
];
---

<BaseLayout
  title={`${pluginMetadata.name[locale]} | Astro Clinical Platform`}
  description={pluginMetadata.description[locale]}
  locale={locale}
  medicalContent={true}
  pageType="calculator"
  breadcrumbs={breadcrumbs}
>
  <main class="container mx-auto px-4 py-8">
    <!-- Ë®àÁÆóÊ©üÊ®ôÈ°åÂíåÊèèËø∞ -->
    <div class="mb-8">
      <h1 class="text-3xl font-bold text-gray-900 mb-4">
        {pluginMetadata.name[locale]}
      </h1>
      <p class="text-lg text-gray-600">
        {pluginMetadata.description[locale]}
      </p>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <!-- Ë®àÁÆóÊ©ü‰∏ªÈ´î -->
      <div class="lg:col-span-2">
        <div class="bg-white rounded-lg border border-gray-200 p-6">
          <PluginCalculator
            client:load
            transition:persist="calculator-id-calculator"
            pluginId="specialty.calculator-id"
            locale={locale}
            theme="light"
            accessibility={{
              highContrast: false,
              largeText: false,
              screenReader: false,
            }}
            className="calculator-id-calculator"
          />
        </div>
      </div>

      <!-- ÂÅ¥ÈÇäÊ¨ÑË≥áË®ä -->
      <div class="space-y-6">
        <!-- ‰ΩøÁî®Ë™™Êòé -->
        <div class="bg-white rounded-lg border border-gray-200 p-6">
          <h2 class="text-lg font-semibold text-gray-900 mb-4">‰ΩøÁî®Ë™™Êòé</h2>
          <!-- Ê∑ªÂä†‰ΩøÁî®Ë™™ÊòéÂÖßÂÆπ -->
        </div>

        <!-- ÈáçË¶ÅÊèêÈÜí -->
        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-6">
          <h2 class="text-lg font-semibold text-yellow-800 mb-3">ÈáçË¶ÅÊèêÈÜí</h2>
          <p class="text-sm text-yellow-700">
            Êú¨Ë®àÁÆóÁµêÊûúÂÉÖ‰æõËá®Â∫äÂèÉËÄÉÔºå‰∏çËÉΩÂèñ‰ª£Â∞àÊ•≠ÈÜ´Â∏´ÁöÑÂà§Êñ∑
          </p>
        </div>
      </div>
    </div>
  </main>
</BaseLayout>
```

### Á¨¨ÂÖ´Ê≠•ÔºöÊõ¥Êñ∞Â∞àÁßëÁ¥¢ÂºïÂíåË®ªÂÜäË°®

#### 8.1 Êõ¥Êñ∞Â∞àÁßëÁ¥¢Âºï (`src/calculators/specialties/index.ts`)

Âú®Â∞çÊáâÂ∞àÁßëÁöÑ `calculators` Êï∏ÁµÑ‰∏≠Ê∑ªÂä†Êñ∞Ë®àÁÆóÂô®Ôºö

```typescript
// ‰æãÂ¶ÇÔºöÂú® cardiology Â∞àÁßë‰∏≠Ê∑ªÂä†Êñ∞Ë®àÁÆóÂô®
cardiology: {
  // ... ÂÖ∂‰ªñÈÖçÁΩÆ
  calculators: ['cardiology.cha2ds2-vasc', 'cardiology.new-calculator-id'],
  // ...
}
```

#### 8.2 Êõ¥Êñ∞ÂèØË¶ñÂåñË®ªÂÜäË°® (`src/config/visualization-registry.ts`)

```typescript
// Â∞éÂÖ•Êñ∞Ë®àÁÆóÂô®ÁöÑÂèØË¶ñÂåñÈÖçÁΩÆ
import newCalculatorVisualization from '../calculators/specialties/{specialty}/{calculator-id}/visualization.json';

// Âú® visualizationRegistry ‰∏≠Ê∑ªÂä†
export const visualizationRegistry = {
  // ... ÁèæÊúâÈÖçÁΩÆ
  '{specialty}.{calculator-id}': newCalculatorVisualization,
};
```

#### 8.3 Êõ¥Êñ∞Á∞°ÂñÆË®àÁÆóÂô®ÊúçÂãô (`src/services/simple-calculator-service.ts`)

Â¶ÇÊûúË®àÁÆóÂô®ÈúÄË¶ÅÂú®Á∞°ÂñÆÊ®°Âºè‰∏ãÈÅãË°åÔºåÈúÄË¶ÅÂú®ÊúçÂãô‰∏≠Ê∑ªÂä†Áõ∏ÊáâÁöÑÂØ¶Áèæ„ÄÇ

### Á¨¨‰πùÊ≠•ÔºöÊõ¥Êñ∞Â∑•ÂÖ∑Á∏ΩË¶ΩÈ†ÅÈù¢

#### 9.1 Âú® `src/pages/tools/index.astro` ‰∏≠Ê∑ªÂä†Êñ∞Ë®àÁÆóÂô®

```javascript
// Âú® staticCalculators Êï∏ÁµÑ‰∏≠Ê∑ªÂä†Êñ∞Ë®àÁÆóÂô®
{
  pluginId: 'specialty.calculator-id',
  urlPath: '/tools/calculator-id',
  metadata: {
    id: 'calculator-id',
    namespace: 'specialty',
    version: '1.0.0',
    name: {
      'zh-TW': 'Ë®àÁÆóÂô®ÂêçÁ®±',
      'en': 'Calculator Name'
    },
    description: {
      'zh-TW': 'Ë®àÁÆóÂô®ÊèèËø∞',
      'en': 'Calculator Description'
    },
    author: 'Astro Clinical Platform',
    tags: ['tag1', 'tag2']
  },
  config: {
    category: 'specialty',
    medical: {
      specialty: ['Â∞àÁßëÂêçÁ®±'],
      evidenceLevel: 'A'
    },
    metadata: {
      difficulty: 'basic'
    }
  },
  namespace: 'specialty'
}
```

#### 9.2 Êõ¥Êñ∞ PluginCalculator ÁµÑ‰ª∂

Âú® `src/components/islands/PluginCalculator.tsx` ÁöÑ `calculatorImplementations` ‰∏≠Ê∑ªÂä†Ôºö

```javascript
'specialty.calculator-id': {
  name: 'Ë®àÁÆóÂô®ÂêçÁ®±',
  fields: [
    // ÂÆöÁæ©Â≠óÊÆµ
  ],
  calculate: (inputs) => {
    // Á∞°ÂåñÁöÑË®àÁÆóÈÇèËºØ
    return {
      // ËøîÂõûÁµêÊûú
    };
  }
}
```

## ‚úÖ È©óË≠âÊ∏ÖÂñÆ

### ÂäüËÉΩÈ©óË≠â

- [ ] **Âü∫Êú¨ÂäüËÉΩ**: Ë®àÁÆóÂô®ËÉΩÊ≠£Á¢∫Âü∑Ë°åË®àÁÆó
- [ ] **Ëº∏ÂÖ•È©óË≠â**: ÈåØË™§Ëº∏ÂÖ•ÊúÉÈ°ØÁ§∫ÈÅ©Áï∂ÈåØË™§Ë®äÊÅØ
- [ ] **ÁµêÊûúÈ°ØÁ§∫**: ÁµêÊûúÊ†ºÂºèÊ≠£Á¢∫‰∏îÊòìÊñºÁêÜËß£
- [ ] **Â§öË™ûË®Ä**: ÊâÄÊúâÊñáÂ≠óÈÉΩÊúâÂ∞çÊáâÁöÑÂ§öË™ûË®ÄÁâàÊú¨
- [ ] **ÈüøÊáâÂºèË®≠Ë®à**: Âú®‰∏çÂêåËû¢ÂπïÂ∞∫ÂØ∏‰∏ãÊ≠£Â∏∏È°ØÁ§∫

### Â∞éËà™È©óË≠â

- [ ] **Â∑•ÂÖ∑È†ÅÈù¢ÈÄ£Áµê**: Âæû `/tools` È†ÅÈù¢ËÉΩÊ≠£Á¢∫Â∞éËà™Âà∞Ë®àÁÆóÂô®
- [ ] **Â∞àÁßëÂàÜÈ°û**: Ë®àÁÆóÂô®Âú®Ê≠£Á¢∫ÁöÑÂ∞àÁßëÂàÜÈ°û‰∏ãÈ°ØÁ§∫
- [ ] **Áõ¥Êé•Ë®™Âïè**: Áõ¥Êé•Ë®™ÂïèË®àÁÆóÂô®URLËÉΩÊ≠£Â∏∏ËºâÂÖ•
- [ ] **Client-side navigation**: ‰ΩøÁî®ÁÄèË¶ΩÂô®ÂâçÈÄ≤/ÂæåÈÄÄÊåâÈàïÊ≠£Â∏∏
- [ ] **Hydration**: ‰∏çÊúÉÂá∫ÁèæËΩâÂúàÂúàÁÑ°Ê≥ïËºâÂÖ•ÁöÑÂïèÈ°å

### ÊäÄË°ìÈ©óË≠â

- [ ] **TypeScript**: Ê≤íÊúâÈ°ûÂûãÈåØË™§
- [ ] **ESLint**: ÈÄöÈÅé‰ª£Á¢ºÊ™¢Êü•
- [ ] **Build**: ËÉΩÊàêÂäüÊßãÂª∫
- [ ] **SSG**: ÈùúÊÖãÁîüÊàêÊ≠£Â∏∏
- [ ] **Â∞àÁßëÁ¥¢Âºï**: Â∞àÁßëÁ¥¢ÂºïÊ≠£Á¢∫Êõ¥Êñ∞
- [ ] **ÂèØË¶ñÂåñË®ªÂÜä**: ÂèØË¶ñÂåñÈÖçÁΩÆÊ≠£Á¢∫Ë®ªÂÜä

### ÈÜ´Â≠∏È©óË≠â

- [ ] **ÂÖ¨ÂºèÊ∫ñÁ¢∫ÊÄß**: Ë®àÁÆóÂÖ¨ÂºèÁ¨¶ÂêàÈÜ´Â≠∏Ê®ôÊ∫ñ
- [ ] **ÂèÉËÄÉÊñáÁçª**: ÂºïÁî®Ê¨äÂ®ÅÈÜ´Â≠∏ÊåáÂºï
- [ ] **ÁµêÊûúËß£Èáã**: ÈÜ´Â≠∏Ëß£ÈáãÊ∫ñÁ¢∫‰∏îÂØ¶Áî®
- [ ] **È¢®Èö™ÂàÜÁ¥ö**: È¢®Èö™Á≠âÁ¥öÂäÉÂàÜÂêàÁêÜ

## ‚ö†Ô∏è Â∏∏Ë¶ãÈåØË™§ÂíåËß£Ê±∫ÊñπÊ°à

### 1. Hydration ÂïèÈ°å

**ÁóáÁãÄ**: Ë®àÁÆóÂô®È°ØÁ§∫ËΩâÂúàÂúàÔºåÁÑ°Ê≥ïËºâÂÖ•
**Ëß£Ê±∫ÊñπÊ°à**:

- Á¢∫‰øùÊ∑ªÂä† `transition:persist="unique-id"` Âà∞ PluginCalculator ÁµÑ‰ª∂
- Ê™¢Êü• pluginId Ê†ºÂºèÊòØÂê¶Ê≠£Á¢∫ (`namespace.calculator-id`)

### 2. È°ûÂûãÈåØË™§

**ÁóáÁãÄ**: TypeScript Á∑®Ë≠ØÈåØË™§
**Ëß£Ê±∫ÊñπÊ°à**:

- Á¢∫‰øùÊâÄÊúâÈ°ûÂûãÂ∞éÂÖ•Ê≠£Á¢∫
- Ê™¢Êü• `calculator.ts` ‰∏≠ÁöÑÂáΩÊï∏Á∞ΩÂêç
- È©óË≠â `config.json` ÁµêÊßãÁ¨¶ÂêàÈ°ûÂûãÂÆöÁæ©

### 3. Ë®àÁÆóÈåØË™§

**ÁóáÁãÄ**: Ë®àÁÆóÁµêÊûú‰∏çÊ≠£Á¢∫
**Ëß£Ê±∫ÊñπÊ°à**:

- Ê™¢Êü•Êï∏ÂÄºËΩâÊèõ (`Number()`, `parseFloat()`)
- È©óË≠âÂñÆ‰ΩçËΩâÊèõÔºàÂ¶Ç cm ËΩâ mÔºâ
- Á¢∫Ë™çÂÖ¨ÂºèÂØ¶ÁèæÊ≠£Á¢∫

### 4. Â§öË™ûË®ÄÂïèÈ°å

**ÁóáÁãÄ**: Êüê‰∫õË™ûË®ÄÈ°ØÁ§∫‰∏çÊ≠£Á¢∫
**Ëß£Ê±∫ÊñπÊ°à**:

- Ê™¢Êü•ÊâÄÊúâÂ§öË™ûË®ÄÂ∞çË±°ÈÉΩÂåÖÂê´ `zh-TW`, `en`, `ja`
- Á¢∫‰øùÊúâÈÅ©Áï∂ÁöÑ fallback ÈÇèËºØ
- È©óË≠â locale ÂèÉÊï∏ÂÇ≥ÈÅûÊ≠£Á¢∫

### 5. Ê®£ÂºèÂïèÈ°å

**ÁóáÁãÄ**: Ë®àÁÆóÂô®Ê®£ÂºèÈ°ØÁ§∫Áï∞Â∏∏
**Ëß£Ê±∫ÊñπÊ°à**:

- Á¢∫‰øù‰ΩøÁî® Tailwind CSS È°ûÂêç
- Ê™¢Êü•ÈüøÊáâÂºèË®≠Ë®àÈ°ûÂêç (`md:`, `lg:`)
- È©óË≠âÂÆπÂô®ÂíåÁ∂≤Ê†ºÂ∏ÉÂ±Ä

### 6. Â∞àÁßëÂàÜÈ°ûÈåØË™§

**ÁóáÁãÄ**: Ë®àÁÆóÂô®ÁÑ°Ê≥ïÂú®Ê≠£Á¢∫ÁöÑÂ∞àÁßë‰∏ãÈ°ØÁ§∫
**Ëß£Ê±∫ÊñπÊ°à**:

- Á¢∫Ë™çË®àÁÆóÂô®ÊîæÂú®Ê≠£Á¢∫ÁöÑÂ∞àÁßëÁõÆÈåÑ‰∏ã
- Ê™¢Êü• `pluginId` Ê†ºÂºèÔºö`specialty.calculator-id`
- È©óË≠âÂ∞àÁßëÁ¥¢Âºï‰∏≠ÁöÑ `calculators` Êï∏ÁµÑÂ∑≤Êõ¥Êñ∞
- Á¢∫Ë™çÂèØË¶ñÂåñË®ªÂÜäË°®‰∏≠ÁöÑÈçµÂêçÊ≠£Á¢∫

### 7. Â∞éËà™ÂïèÈ°å

**ÁóáÁãÄ**: ÁÑ°Ê≥ïÂæûÂ∑•ÂÖ∑È†ÅÈù¢Â∞éËà™Âà∞Ë®àÁÆóÂô®
**Ëß£Ê±∫ÊñπÊ°à**:

- Ê™¢Êü• `urlPath` ÊòØÂê¶Ê≠£Á¢∫
- Á¢∫Ë™çÈ†ÅÈù¢Êñá‰ª∂ÂêçËàáË∑ØÂæëÂåπÈÖç
- È©óË≠â `staticCalculators` ÈÖçÁΩÆ
- Á¢∫Ë™çÂ∞àÁßëÂàÜÈ°ûÈÖçÁΩÆÊ≠£Á¢∫

## üìö ÊúÄ‰Ω≥ÂØ¶Ë∏ê

### ‰ª£Á¢ºÁµÑÁπî

1. **Â∞àÁßëÂàÜÈ°û**: ÈÅ∏ÊìáÊúÄÈÅ©ÂêàÁöÑÈÜ´ÁôÇÂ∞àÁßëÂàÜÈ°û
2. **ÂñÆ‰∏ÄËÅ∑Ë≤¨**: ÊØèÂÄãÊñá‰ª∂Âè™Ë≤†Ë≤¨‰∏ÄÂÄãÂäüËÉΩ
3. **È°ûÂûãÂÆâÂÖ®**: ÂÖÖÂàÜÂà©Áî® TypeScript È°ûÂûãÊ™¢Êü•
4. **ÈåØË™§ËôïÁêÜ**: Êèê‰æõÊ∏ÖÊô∞ÁöÑÈåØË™§Ë®äÊÅØ
5. **ÊñáÊ™îË®ªÈáã**: ÁÇ∫Ë§áÈõúÈÇèËºØÊ∑ªÂä†Ë®ªÈáã
6. **ÂëΩÂêç‰∏ÄËá¥**: ÈÅµÂæ™ÁèæÊúâÁöÑÂëΩÂêçÊÖ£‰æã

### Áî®Êà∂È´îÈ©ó

1. **Âç≥ÊôÇÈ©óË≠â**: Ëº∏ÂÖ•ÊôÇÁ´ãÂç≥È°ØÁ§∫È©óË≠âÁµêÊûú
2. **Ê∏ÖÊô∞ÂèçÈ•ã**: Êèê‰æõÊòéÁ¢∫ÁöÑÊàêÂäü/ÈåØË™§ÁãÄÊÖã
3. **ÈüøÊáâÂºèË®≠Ë®à**: ÈÅ©ÈÖçÂêÑÁ®ÆË®≠ÂÇô
4. **ÁÑ°ÈöúÁ§ôË®≠Ë®à**: ÊîØÊåÅËû¢ÂπïÈñ±ËÆÄÂô®

### ÈÜ´Â≠∏Ê∫ñÁ¢∫ÊÄß

1. **Ê¨äÂ®Å‰æÜÊ∫ê**: ‰ΩøÁî®Ê¨äÂ®ÅÈÜ´Â≠∏ÊåáÂºï
2. **ÁâàÊú¨ÊéßÂà∂**: Ë®òÈåÑÂÖ¨ÂºèÁâàÊú¨ÂíåÊõ¥Êñ∞Êó•Êúü
3. **ÂêåË°åË©ïË≠∞**: ÈÇÄË´ãÈÜ´Â≠∏Â∞àÂÆ∂ÂØ©Ê†∏
4. **ÊåÅÁ∫åÊõ¥Êñ∞**: ÂÆöÊúüÊõ¥Êñ∞ÈÜ´Â≠∏Ê®ôÊ∫ñ

### ÊÄßËÉΩÂÑ™Âåñ

1. **Êá∂Âä†Ëºâ**: ‰ΩøÁî® `client:load` ÈÅ©Áï∂ÊôÇÊ©ü
2. **ÁãÄÊÖãÊåÅ‰πÖ**: ‰ΩøÁî® `transition:persist` ÈÅøÂÖçÈáçÊñ∞ËºâÂÖ•
3. **Á∑©Â≠òÁ≠ñÁï•**: ÂêàÁêÜ‰ΩøÁî®ÁÄèË¶ΩÂô®Á∑©Â≠ò
4. **‰ª£Á¢ºÂàÜÂâ≤**: ÈÅøÂÖç‰∏çÂøÖË¶ÅÁöÑ‰æùË≥¥

## üîß ÈñãÁôºÂ∑•ÂÖ∑

### Êé®Ëñ¶Â∑•ÂÖ∑

- **VS Code**: ‰∏ªË¶ÅÈñãÁôºÁí∞Â¢É
- **TypeScript**: È°ûÂûãÊ™¢Êü•
- **ESLint**: ‰ª£Á¢ºÊ™¢Êü•
- **Prettier**: ‰ª£Á¢ºÊ†ºÂºèÂåñ
- **Chrome DevTools**: Ë™øË©¶Â∑•ÂÖ∑

### ÊúâÁî®ÁöÑÂëΩ‰ª§

```bash
# ÈñãÁôºÊúçÂãôÂô®
npm run dev

# È°ûÂûãÊ™¢Êü•
npm run type-check

# ‰ª£Á¢ºÊ™¢Êü•
npm run lint

# ÊßãÂª∫È†ÖÁõÆ
npm run build

# È†êË¶ΩÊßãÂª∫ÁµêÊûú
npm run preview
```

## üìñ ÂèÉËÄÉË≥áÊ∫ê

### ÊäÄË°ìÊñáÊ™î

- [Astro ÂÆòÊñπÊñáÊ™î](https://docs.astro.build/)
- [React ÂÆòÊñπÊñáÊ™î](https://react.dev/)
- [TypeScript ÊâãÂÜä](https://www.typescriptlang.org/docs/)
- [Tailwind CSS ÊñáÊ™î](https://tailwindcss.com/docs)

### ÈÜ´Â≠∏Ë≥áÊ∫ê

- [WHO ÂÆòÊñπÊåáÂºï](https://www.who.int/)
- [ESC ÂøÉËáüÁóÖÂ≠∏ÊúÉÊåáÂºï](https://www.escardio.org/)
- [KDIGO ËÖéËáüÁóÖÊåáÂºï](https://kdigo.org/)
- [Âè∞ÁÅ£Ë°õÁîüÁ¶èÂà©ÈÉ®](https://www.mohw.gov.tw/)

## üöÄ Âø´ÈÄüÊ™¢Êü•Ê∏ÖÂñÆ

Âú®Êèê‰∫§Êñ∞Ë®àÁÆóÂô®‰πãÂâçÔºåË´ãÁ¢∫Ë™ç‰ª•‰∏ãÊâÄÊúâÈ†ÖÁõÆÔºö

### Êñá‰ª∂ÁµêÊßã ‚úÖ

- [ ] Ë®àÁÆóÂô®ÊîæÂú®Ê≠£Á¢∫ÁöÑÂ∞àÁßëÁõÆÈåÑÔºö`src/calculators/specialties/{specialty}/{calculator-id}/`
- [ ] ÂåÖÂê´ÊâÄÊúâÂøÖË¶ÅÊñá‰ª∂Ôºö`config.json`, `calculator.ts`, `index.ts`, `Dashboard.tsx`, `visualization.json`
- [ ] ÂâµÂª∫Ê∏¨Ë©¶Êñá‰ª∂Ôºö`__tests__/calculator.test.ts`

### ÈÖçÁΩÆÊõ¥Êñ∞ ‚úÖ

- [ ] Êõ¥Êñ∞Â∞àÁßëÁ¥¢ÂºïÔºö`src/calculators/specialties/index.ts`
- [ ] Êõ¥Êñ∞ÂèØË¶ñÂåñË®ªÂÜäË°®Ôºö`src/config/visualization-registry.ts`
- [ ] Êõ¥Êñ∞Â∑•ÂÖ∑Á∏ΩË¶ΩÈ†ÅÈù¢Ôºö`src/pages/tools/index.astro`
- [ ] Êõ¥Êñ∞ PluginCalculator ÁµÑ‰ª∂ÂØ¶Áèæ

### È†ÅÈù¢ÂâµÂª∫ ‚úÖ

- [ ] ÂâµÂª∫Â∞àÁî®È†ÅÈù¢Ôºö`src/pages/tools/{calculator-id}.astro`
- [ ] ÈÖçÁΩÆÊ≠£Á¢∫ÁöÑ pluginIdÔºö`{specialty}.{calculator-id}`
- [ ] Ê∑ªÂä†ÈÅ©Áï∂ÁöÑ meta ‰ø°ÊÅØÂíåÈ∫µÂåÖÂ±ë

### Ê∏¨Ë©¶È©óË≠â ‚úÖ

- [ ] Ë®àÁÆóÈÇèËºØÊ≠£Á¢∫
- [ ] Ëº∏ÂÖ•È©óË≠âÊúâÊïà
- [ ] Â§öË™ûË®ÄÊîØÊåÅÂÆåÊï¥
- [ ] ÈüøÊáâÂºèË®≠Ë®àÊ≠£Â∏∏
- [ ] ÊßãÂª∫ÊàêÂäüÁÑ°ÈåØË™§

### ÈÜ´Â≠∏È©óË≠â ‚úÖ

- [ ] ÂÖ¨Âºè‰æÜÊ∫êÊ¨äÂ®Å
- [ ] ÁµêÊûúËß£ÈáãÊ∫ñÁ¢∫
- [ ] È¢®Èö™ÂàÜÁ¥öÂêàÁêÜ
- [ ] Ëá®Â∫äÂª∫Ë≠∞ÂØ¶Áî®

---

**ÁâàÊú¨**: 2.0.0  
**ÊúÄÂæåÊõ¥Êñ∞**: 2025-07-29  
**Á∂≠Ë≠∑ËÄÖ**: Astro Clinical Platform Team

Ê≠§ SOP Â∑≤Êõ¥Êñ∞‰ª•ÂèçÊò†Êñ∞ÁöÑÂ∞àÁßëÂàÜÈ°ûÁµêÊßãÔºåË´ãÈÅµÂæ™ÊúÄÊñ∞ÁöÑÈñãÁôºÊµÅÁ®ã„ÄÇ
