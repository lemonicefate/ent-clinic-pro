name: é€²éšå…§å®¹é©—è­‰

on:
  pull_request:
    branches: [ main, master ]
    paths:
      - 'src/content/education/**'
      - 'src/content/medical-specialties/**'
      - 'src/content/templates/**'
  push:
    branches: [ main, master ]
    paths:
      - 'src/content/education/**'
      - 'src/content/medical-specialties/**'

jobs:
  # Frontmatter æ ¼å¼é©—è­‰
  frontmatter-validation:
    runs-on: ubuntu-latest
    name: Frontmatter æ ¼å¼é©—è­‰
    
    steps:
    - name: æª¢å‡ºç¨‹å¼ç¢¼
      uses: actions/checkout@v4
      
    - name: è¨­å®š Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: å®‰è£ä¾è³´
      run: npm ci
      
    - name: é©—è­‰ Frontmatter çµæ§‹
      run: |
        echo "é©—è­‰ Frontmatter çµæ§‹..."
        
        # å»ºç«‹é©—è­‰è…³æœ¬
        cat > validate-frontmatter.js << 'EOF'
        const fs = require('fs');
        const path = require('path');
        const yaml = require('js-yaml');
        
        const requiredFields = {
          title: 'string',
          description: 'string',
          specialty: 'string',
          status: ['draft', 'in-review', 'published'],
          publishDate: 'date',
          tags: 'array',
          author: 'string',
          reviewers: 'array'
        };
        
        const specialtyValues = [
          'cardiology', 'neurology', 'pediatrics', 
          'emergency', 'orthopedics', 'general'
        ];
        
        function validateFrontmatter(filePath) {
          const content = fs.readFileSync(filePath, 'utf8');
          const frontmatterMatch = content.match(/^---\n([\s\S]*?)\n---/);
          
          if (!frontmatterMatch) {
            throw new Error(`ç¼ºå°‘ frontmatter: ${filePath}`);
          }
          
          let frontmatter;
          try {
            frontmatter = yaml.load(frontmatterMatch[1]);
          } catch (error) {
            throw new Error(`Frontmatter YAML æ ¼å¼éŒ¯èª¤ ${filePath}: ${error.message}`);
          }
          
          // æª¢æŸ¥å¿…è¦æ¬„ä½
          for (const [field, type] of Object.entries(requiredFields)) {
            if (!frontmatter.hasOwnProperty(field)) {
              throw new Error(`ç¼ºå°‘å¿…è¦æ¬„ä½ '${field}' in ${filePath}`);
            }
            
            const value = frontmatter[field];
            
            if (Array.isArray(type)) {
              // æšèˆ‰å€¼æª¢æŸ¥
              if (!type.includes(value)) {
                throw new Error(`æ¬„ä½ '${field}' å€¼ '${value}' ä¸åœ¨å…è¨±ç¯„åœ [${type.join(', ')}] in ${filePath}`);
              }
            } else if (type === 'array') {
              if (!Array.isArray(value)) {
                throw new Error(`æ¬„ä½ '${field}' å¿…é ˆæ˜¯é™£åˆ— in ${filePath}`);
              }
            } else if (type === 'string') {
              if (typeof value !== 'string' || value.trim() === '') {
                throw new Error(`æ¬„ä½ '${field}' å¿…é ˆæ˜¯éç©ºå­—ä¸² in ${filePath}`);
              }
            } else if (type === 'date') {
              if (!(value instanceof Date) && isNaN(Date.parse(value))) {
                throw new Error(`æ¬„ä½ '${field}' å¿…é ˆæ˜¯æœ‰æ•ˆæ—¥æœŸ in ${filePath}`);
              }
            }
          }
          
          // æª¢æŸ¥å°ˆç§‘å€¼
          if (!specialtyValues.includes(frontmatter.specialty)) {
            throw new Error(`å°ˆç§‘ '${frontmatter.specialty}' ä¸åœ¨å…è¨±ç¯„åœ [${specialtyValues.join(', ')}] in ${filePath}`);
          }
          
          // æª¢æŸ¥æè¿°é•·åº¦
          if (frontmatter.description.length < 50 || frontmatter.description.length > 160) {
            console.warn(`âš ï¸ æè¿°é•·åº¦å»ºè­°åœ¨ 50-160 å­—å…ƒä¹‹é–“: ${filePath} (ç›®å‰: ${frontmatter.description.length})`);
          }
          
          // æª¢æŸ¥æ¨™ç±¤
          if (frontmatter.tags.length === 0) {
            console.warn(`âš ï¸ å»ºè­°è‡³å°‘æ·»åŠ ä¸€å€‹æ¨™ç±¤: ${filePath}`);
          }
          
          console.log(`âœ… ${filePath} frontmatter é©—è­‰é€šé`);
        }
        
        // æƒææ‰€æœ‰æ•™è‚²å…§å®¹æª”æ¡ˆ
        const educationDir = 'src/content/education';
        if (fs.existsSync(educationDir)) {
          const files = fs.readdirSync(educationDir, { recursive: true })
            .filter(file => file.endsWith('.md'))
            .map(file => path.join(educationDir, file));
          
          let errors = 0;
          for (const file of files) {
            try {
              validateFrontmatter(file);
            } catch (error) {
              console.error(`âŒ ${error.message}`);
              errors++;
            }
          }
          
          if (errors > 0) {
            console.error(`\nç¸½è¨ˆ ${errors} å€‹ frontmatter éŒ¯èª¤`);
            process.exit(1);
          }
          
          console.log(`\nâœ… æ‰€æœ‰ ${files.length} å€‹æª”æ¡ˆçš„ frontmatter é©—è­‰é€šé`);
        }
        EOF
        
        node validate-frontmatter.js

  # Markdown èªæ³•å’Œé€£çµé©—è­‰
  markdown-validation:
    runs-on: ubuntu-latest
    name: Markdown èªæ³•å’Œé€£çµé©—è­‰
    
    steps:
    - name: æª¢å‡ºç¨‹å¼ç¢¼
      uses: actions/checkout@v4
      
    - name: è¨­å®š Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: å®‰è£ markdownlint
      run: npm install -g markdownlint-cli2
      
    - name: å»ºç«‹ markdownlint é…ç½®
      run: |
        cat > .markdownlint.json << 'EOF'
        {
          "default": true,
          "MD013": {
            "line_length": 120,
            "heading_line_length": 80,
            "code_block_line_length": 120
          },
          "MD033": {
            "allowed_elements": ["br", "sub", "sup", "kbd", "mark"]
          },
          "MD041": false,
          "MD025": {
            "front_matter_title": "^\\s*title\\s*[:=]"
          },
          "MD024": {
            "siblings_only": true
          },
          "MD026": {
            "punctuation": ".,;:!?"
          },
          "MD029": {
            "style": "ordered"
          },
          "MD036": false,
          "MD046": {
            "style": "fenced"
          }
        }
        EOF
        
    - name: åŸ·è¡Œ Markdown èªæ³•æª¢æŸ¥
      run: |
        echo "åŸ·è¡Œ Markdown èªæ³•æª¢æŸ¥..."
        markdownlint-cli2 "src/content/education/**/*.md" || exit 1
        
    - name: æª¢æŸ¥å…§éƒ¨é€£çµ
      run: |
        echo "æª¢æŸ¥å…§éƒ¨é€£çµ..."
        
        cat > check-links.js << 'EOF'
        const fs = require('fs');
        const path = require('path');
        
        function checkInternalLinks() {
          const educationDir = 'src/content/education';
          const files = fs.readdirSync(educationDir, { recursive: true })
            .filter(file => file.endsWith('.md'))
            .map(file => path.join(educationDir, file));
          
          const linkPattern = /\[([^\]]+)\]\(([^)]+)\)/g;
          const internalLinkPattern = /^\/|^\.\.?\//;
          let errors = 0;
          
          for (const file of files) {
            const content = fs.readFileSync(file, 'utf8');
            let match;
            
            while ((match = linkPattern.exec(content)) !== null) {
              const [fullMatch, text, url] = match;
              
              // æª¢æŸ¥å…§éƒ¨é€£çµ
              if (internalLinkPattern.test(url)) {
                // ç°¡å–®æª¢æŸ¥ï¼šç¢ºä¿ä¸æ˜¯æ˜é¡¯çš„éŒ¯èª¤æ ¼å¼
                if (url.includes('..') && !url.startsWith('../')) {
                  console.error(`âŒ å¯ç–‘çš„å…§éƒ¨é€£çµæ ¼å¼: ${url} in ${file}`);
                  errors++;
                }
                
                // æª¢æŸ¥é€£çµæ–‡å­—
                if (text.trim() === '') {
                  console.error(`âŒ é€£çµæ–‡å­—ç‚ºç©º: ${fullMatch} in ${file}`);
                  errors++;
                }
              }
              
              // æª¢æŸ¥å¤–éƒ¨é€£çµæ ¼å¼
              if (url.startsWith('http')) {
                if (!url.startsWith('https://') && !url.startsWith('http://')) {
                  console.error(`âŒ ç„¡æ•ˆçš„ URL æ ¼å¼: ${url} in ${file}`);
                  errors++;
                }
              }
            }
          }
          
          if (errors > 0) {
            console.error(`\nç¸½è¨ˆ ${errors} å€‹é€£çµéŒ¯èª¤`);
            process.exit(1);
          }
          
          console.log('âœ… æ‰€æœ‰é€£çµæª¢æŸ¥é€šé');
        }
        
        checkInternalLinks();
        EOF
        
        node check-links.js

  # SEO å’Œç„¡éšœç¤™æ€§æª¢æŸ¥
  seo-accessibility-validation:
    runs-on: ubuntu-latest
    name: SEO å’Œç„¡éšœç¤™æ€§æª¢æŸ¥
    
    steps:
    - name: æª¢å‡ºç¨‹å¼ç¢¼
      uses: actions/checkout@v4
      
    - name: è¨­å®š Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: SEO å…ƒè³‡æ–™æª¢æŸ¥
      run: |
        echo "æª¢æŸ¥ SEO å…ƒè³‡æ–™..."
        
        cat > check-seo.js << 'EOF'
        const fs = require('fs');
        const path = require('path');
        const yaml = require('js-yaml');
        
        function checkSEO() {
          const educationDir = 'src/content/education';
          const files = fs.readdirSync(educationDir, { recursive: true })
            .filter(file => file.endsWith('.md'))
            .map(file => path.join(educationDir, file));
          
          let warnings = 0;
          let errors = 0;
          
          for (const file of files) {
            const content = fs.readFileSync(file, 'utf8');
            const frontmatterMatch = content.match(/^---\n([\s\S]*?)\n---/);
            
            if (!frontmatterMatch) continue;
            
            const frontmatter = yaml.load(frontmatterMatch[1]);
            const bodyContent = content.replace(/^---\n[\s\S]*?\n---\n/, '');
            
            // æª¢æŸ¥æ¨™é¡Œé•·åº¦
            if (frontmatter.title) {
              if (frontmatter.title.length > 60) {
                console.warn(`âš ï¸ æ¨™é¡Œéé•· (${frontmatter.title.length} å­—å…ƒï¼Œå»ºè­° < 60): ${file}`);
                warnings++;
              }
              if (frontmatter.title.length < 10) {
                console.warn(`âš ï¸ æ¨™é¡ŒéçŸ­ (${frontmatter.title.length} å­—å…ƒï¼Œå»ºè­° > 10): ${file}`);
                warnings++;
              }
            }
            
            // æª¢æŸ¥æè¿°
            if (frontmatter.description) {
              if (frontmatter.description.length > 160) {
                console.warn(`âš ï¸ æè¿°éé•· (${frontmatter.description.length} å­—å…ƒï¼Œå»ºè­° < 160): ${file}`);
                warnings++;
              }
              if (frontmatter.description.length < 50) {
                console.warn(`âš ï¸ æè¿°éçŸ­ (${frontmatter.description.length} å­—å…ƒï¼Œå»ºè­° > 50): ${file}`);
                warnings++;
              }
            }
            
            // æª¢æŸ¥æ¨™ç±¤
            if (!frontmatter.tags || frontmatter.tags.length === 0) {
              console.warn(`âš ï¸ ç¼ºå°‘æ¨™ç±¤: ${file}`);
              warnings++;
            } else if (frontmatter.tags.length > 10) {
              console.warn(`âš ï¸ æ¨™ç±¤éå¤š (${frontmatter.tags.length}ï¼Œå»ºè­° < 10): ${file}`);
              warnings++;
            }
            
            // æª¢æŸ¥å…§å®¹çµæ§‹
            const headingPattern = /^#{1,6}\s+(.+)$/gm;
            const headings = [];
            let match;
            
            while ((match = headingPattern.exec(bodyContent)) !== null) {
              const level = match[0].indexOf(' ');
              headings.push({ level, text: match[1] });
            }
            
            if (headings.length === 0) {
              console.error(`âŒ å…§å®¹ç¼ºå°‘æ¨™é¡Œçµæ§‹: ${file}`);
              errors++;
            }
            
            // æª¢æŸ¥å…§å®¹é•·åº¦
            const wordCount = bodyContent.split(/\s+/).length;
            if (wordCount < 200) {
              console.warn(`âš ï¸ å…§å®¹éçŸ­ (${wordCount} å­—ï¼Œå»ºè­° > 200): ${file}`);
              warnings++;
            }
            
            console.log(`âœ… ${file} SEO æª¢æŸ¥å®Œæˆ`);
          }
          
          console.log(`\nğŸ“Š SEO æª¢æŸ¥çµæœ: ${errors} éŒ¯èª¤, ${warnings} è­¦å‘Š`);
          
          if (errors > 0) {
            process.exit(1);
          }
        }
        
        checkSEO();
        EOF
        
        node check-seo.js
        
    - name: ç„¡éšœç¤™æ€§æª¢æŸ¥
      run: |
        echo "æª¢æŸ¥ç„¡éšœç¤™æ€§..."
        
        cat > check-accessibility.js << 'EOF'
        const fs = require('fs');
        const path = require('path');
        
        function checkAccessibility() {
          const educationDir = 'src/content/education';
          const files = fs.readdirSync(educationDir, { recursive: true })
            .filter(file => file.endsWith('.md'))
            .map(file => path.join(educationDir, file));
          
          let errors = 0;
          let warnings = 0;
          
          for (const file of files) {
            const content = fs.readFileSync(file, 'utf8');
            
            // æª¢æŸ¥åœ–ç‰‡ alt æ–‡å­—
            const imagePattern = /!\[([^\]]*)\]\([^)]+\)/g;
            let match;
            
            while ((match = imagePattern.exec(content)) !== null) {
              const altText = match[1];
              
              if (!altText || altText.trim() === '') {
                console.error(`âŒ åœ–ç‰‡ç¼ºå°‘ alt æ–‡å­—: ${match[0]} in ${file}`);
                errors++;
              } else if (altText.length < 5) {
                console.warn(`âš ï¸ Alt æ–‡å­—éçŸ­: "${altText}" in ${file}`);
                warnings++;
              } else if (altText.length > 125) {
                console.warn(`âš ï¸ Alt æ–‡å­—éé•· (${altText.length} å­—å…ƒ): "${altText}" in ${file}`);
                warnings++;
              }
            }
            
            // æª¢æŸ¥æ¨™é¡Œå±¤ç´šçµæ§‹
            const headingPattern = /^(#{1,6})\s+(.+)$/gm;
            const headings = [];
            
            while ((match = headingPattern.exec(content)) !== null) {
              headings.push({
                level: match[1].length,
                text: match[2],
                line: content.substring(0, match.index).split('\n').length
              });
            }
            
            // æª¢æŸ¥æ¨™é¡Œå±¤ç´šè·³èº
            for (let i = 1; i < headings.length; i++) {
              const prevLevel = headings[i - 1].level;
              const currentLevel = headings[i].level;
              
              if (currentLevel > prevLevel + 1) {
                console.warn(`âš ï¸ æ¨™é¡Œå±¤ç´šè·³èº (H${prevLevel} -> H${currentLevel}) ç¬¬ ${headings[i].line} è¡Œ: ${file}`);
                warnings++;
              }
            }
            
            // æª¢æŸ¥é€£çµæ–‡å­—
            const linkPattern = /\[([^\]]+)\]\([^)]+\)/g;
            
            while ((match = linkPattern.exec(content)) !== null) {
              const linkText = match[1];
              
              if (linkText.toLowerCase().includes('é»æ“Š') || 
                  linkText.toLowerCase().includes('click') ||
                  linkText.toLowerCase().includes('é€™è£¡')) {
                console.warn(`âš ï¸ é€£çµæ–‡å­—ä¸å¤ æè¿°æ€§: "${linkText}" in ${file}`);
                warnings++;
              }
            }
            
            console.log(`âœ… ${file} ç„¡éšœç¤™æ€§æª¢æŸ¥å®Œæˆ`);
          }
          
          console.log(`\nğŸ“Š ç„¡éšœç¤™æ€§æª¢æŸ¥çµæœ: ${errors} éŒ¯èª¤, ${warnings} è­¦å‘Š`);
          
          if (errors > 0) {
            process.exit(1);
          }
        }
        
        checkAccessibility();
        EOF
        
        node check-accessibility.js

  # é†«ç™‚å…§å®¹ç‰¹å®šæª¢æŸ¥
  medical-content-validation:
    runs-on: ubuntu-latest
    name: é†«ç™‚å…§å®¹ç‰¹å®šæª¢æŸ¥
    
    steps:
    - name: æª¢å‡ºç¨‹å¼ç¢¼
      uses: actions/checkout@v4
      
    - name: è¨­å®š Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: é†«ç™‚è¡“èªå’Œæ ¼å¼æª¢æŸ¥
      run: |
        echo "æª¢æŸ¥é†«ç™‚è¡“èªå’Œæ ¼å¼..."
        
        cat > check-medical-content.js << 'EOF'
        const fs = require('fs');
        const path = require('path');
        const yaml = require('js-yaml');
        
        // é†«ç™‚è¡“èªè©å…¸
        const medicalTerms = {
          // å¸¸è¦‹é†«ç™‚ç¸®å¯«
          'ECG': 'electrocardiogram',
          'MRI': 'magnetic resonance imaging',
          'CT': 'computed tomography',
          'ICU': 'intensive care unit',
          'ER': 'emergency room',
          'BP': 'blood pressure',
          'HR': 'heart rate',
          'IV': 'intravenous',
          'PO': 'per os (by mouth)',
          'PRN': 'pro re nata (as needed)'
        };
        
        // éœ€è¦æª¢æŸ¥çš„é†«ç™‚ç« ç¯€
        const requiredSections = {
          cardiology: ['ç—‡ç‹€', 'è¨ºæ–·', 'æ²»ç™‚', 'é é˜²'],
          neurology: ['ç—‡ç‹€', 'è¨ºæ–·', 'æ²»ç™‚', 'é å¾Œ'],
          pediatrics: ['ç—‡ç‹€', 'è¨ºæ–·', 'æ²»ç™‚', 'ç…§è­·'],
          emergency: ['ç—‡ç‹€', 'è™•ç†', 'è½‰è¨º', 'é é˜²'],
          orthopedics: ['ç—‡ç‹€', 'è¨ºæ–·', 'æ²»ç™‚', 'å¾©å¥']
        };
        
        // å±éšªè©å½™ - éœ€è¦ç‰¹åˆ¥æ³¨æ„çš„é†«ç™‚å»ºè­°
        const dangerousTerms = [
          'ä¸€å®šæœƒ', 'çµ•å°', 'æ°¸é ä¸æœƒ', 'å®Œå…¨æ²»ç™’',
          'ç«‹å³åœè—¥', 'è‡ªè¡Œèª¿æ•´åŠ‘é‡', 'ä¸éœ€è¦çœ‹é†«ç”Ÿ'
        ];
        
        function checkMedicalContent() {
          const educationDir = 'src/content/education';
          const files = fs.readdirSync(educationDir, { recursive: true })
            .filter(file => file.endsWith('.md'))
            .map(file => path.join(educationDir, file));
          
          let errors = 0;
          let warnings = 0;
          
          for (const file of files) {
            const content = fs.readFileSync(file, 'utf8');
            const frontmatterMatch = content.match(/^---\n([\s\S]*?)\n---/);
            
            if (!frontmatterMatch) continue;
            
            const frontmatter = yaml.load(frontmatterMatch[1]);
            const bodyContent = content.replace(/^---\n[\s\S]*?\n---\n/, '');
            const specialty = frontmatter.specialty;
            
            // æª¢æŸ¥å¿…è¦ç« ç¯€
            if (requiredSections[specialty]) {
              const requiredSecs = requiredSections[specialty];
              const headingPattern = /^#{2,6}\s+(.+)$/gm;
              const headings = [];
              let match;
              
              while ((match = headingPattern.exec(bodyContent)) !== null) {
                headings.push(match[1]);
              }
              
              for (const requiredSec of requiredSecs) {
                const hasSection = headings.some(heading => 
                  heading.includes(requiredSec) || 
                  heading.toLowerCase().includes(requiredSec.toLowerCase())
                );
                
                if (!hasSection) {
                  console.warn(`âš ï¸ å»ºè­°åŒ…å«ã€Œ${requiredSec}ã€ç›¸é—œç« ç¯€: ${file}`);
                  warnings++;
                }
              }
            }
            
            // æª¢æŸ¥å±éšªè©å½™
            for (const term of dangerousTerms) {
              if (bodyContent.includes(term)) {
                console.error(`âŒ ç™¼ç¾å¯èƒ½å±éšªçš„é†«ç™‚å»ºè­°è©å½™ã€Œ${term}ã€: ${file}`);
                errors++;
              }
            }
            
            // æª¢æŸ¥é†«ç™‚å…è²¬è²æ˜
            const disclaimerKeywords = ['é†«å¸«', 'å°ˆæ¥­', 'å»ºè­°', 'è¨ºæ–·', 'æ²»ç™‚'];
            const hasDisclaimer = disclaimerKeywords.some(keyword => 
              bodyContent.toLowerCase().includes(keyword)
            );
            
            if (!hasDisclaimer) {
              console.warn(`âš ï¸ å»ºè­°åŒ…å«é†«ç™‚å…è²¬è²æ˜æˆ–å°ˆæ¥­å»ºè­°æé†’: ${file}`);
              warnings++;
            }
            
            // æª¢æŸ¥è—¥ç‰©åŠ‘é‡æ ¼å¼
            const dosagePattern = /\d+\s*(mg|g|ml|mcg|Î¼g|IU|units?)\b/gi;
            const dosageMatches = bodyContent.match(dosagePattern);
            
            if (dosageMatches) {
              console.warn(`âš ï¸ ç™¼ç¾è—¥ç‰©åŠ‘é‡è³‡è¨Šï¼Œè«‹ç¢ºä¿æº–ç¢ºæ€§: ${dosageMatches.join(', ')} in ${file}`);
              warnings++;
            }
            
            // æª¢æŸ¥åƒè€ƒæ–‡ç»
            const referencePattern = /\[(\d+)\]|\(.*\d{4}.*\)/g;
            const hasReferences = referencePattern.test(bodyContent);
            
            if (!hasReferences && bodyContent.length > 1000) {
              console.warn(`âš ï¸ é•·ç¯‡é†«ç™‚å…§å®¹å»ºè­°åŒ…å«åƒè€ƒæ–‡ç»: ${file}`);
              warnings++;
            }
            
            console.log(`âœ… ${file} é†«ç™‚å…§å®¹æª¢æŸ¥å®Œæˆ`);
          }
          
          console.log(`\nğŸ“Š é†«ç™‚å…§å®¹æª¢æŸ¥çµæœ: ${errors} éŒ¯èª¤, ${warnings} è­¦å‘Š`);
          
          if (errors > 0) {
            process.exit(1);
          }
        }
        
        checkMedicalContent();
        EOF
        
        node check-medical-content.js

  # å…§å®¹çµæ§‹å’Œå¯è®€æ€§åˆ†æ
  content-structure-analysis:
    runs-on: ubuntu-latest
    name: å…§å®¹çµæ§‹å’Œå¯è®€æ€§åˆ†æ
    
    steps:
    - name: æª¢å‡ºç¨‹å¼ç¢¼
      uses: actions/checkout@v4
      
    - name: è¨­å®š Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: å…§å®¹çµæ§‹åˆ†æ
      run: |
        echo "åˆ†æå…§å®¹çµæ§‹å’Œå¯è®€æ€§..."
        
        cat > analyze-content.js << 'EOF'
        const fs = require('fs');
        const path = require('path');
        const yaml = require('js-yaml');
        
        function analyzeContent() {
          const educationDir = 'src/content/education';
          const files = fs.readdirSync(educationDir, { recursive: true })
            .filter(file => file.endsWith('.md'))
            .map(file => path.join(educationDir, file));
          
          let warnings = 0;
          const stats = {
            totalFiles: files.length,
            avgWordCount: 0,
            avgReadingTime: 0,
            structureIssues: 0
          };
          
          let totalWords = 0;
          
          for (const file of files) {
            const content = fs.readFileSync(file, 'utf8');
            const frontmatterMatch = content.match(/^---\n([\s\S]*?)\n---/);
            
            if (!frontmatterMatch) continue;
            
            const bodyContent = content.replace(/^---\n[\s\S]*?\n---\n/, '');
            
            // å­—æ•¸çµ±è¨ˆ
            const words = bodyContent.split(/\s+/).filter(word => word.length > 0);
            const wordCount = words.length;
            totalWords += wordCount;
            
            // é–±è®€æ™‚é–“ä¼°ç®— (æ¯åˆ†é˜ 200 å­—)
            const readingTime = Math.ceil(wordCount / 200);
            
            // æ®µè½åˆ†æ
            const paragraphs = bodyContent.split(/\n\s*\n/).filter(p => p.trim().length > 0);
            const avgParagraphLength = paragraphs.reduce((sum, p) => sum + p.split(/\s+/).length, 0) / paragraphs.length;
            
            // å¥å­é•·åº¦åˆ†æ
            const sentences = bodyContent.split(/[.!?]+/).filter(s => s.trim().length > 0);
            const avgSentenceLength = sentences.reduce((sum, s) => sum + s.split(/\s+/).length, 0) / sentences.length;
            
            // æ¨™é¡Œçµæ§‹åˆ†æ
            const headingPattern = /^(#{1,6})\s+(.+)$/gm;
            const headings = [];
            let match;
            
            while ((match = headingPattern.exec(bodyContent)) !== null) {
              headings.push({
                level: match[1].length,
                text: match[2]
              });
            }
            
            // æª¢æŸ¥å…§å®¹å“è³ªæŒ‡æ¨™
            if (wordCount < 300) {
              console.warn(`âš ï¸ å…§å®¹è¼ƒçŸ­ (${wordCount} å­—): ${file}`);
              warnings++;
            } else if (wordCount > 3000) {
              console.warn(`âš ï¸ å…§å®¹è¼ƒé•· (${wordCount} å­—ï¼Œå»ºè­°åˆ†å‰²): ${file}`);
              warnings++;
            }
            
            if (avgParagraphLength > 100) {
              console.warn(`âš ï¸ æ®µè½å¹³å‡é•·åº¦éé•· (${Math.round(avgParagraphLength)} å­—/æ®µ): ${file}`);
              warnings++;
            }
            
            if (avgSentenceLength > 25) {
              console.warn(`âš ï¸ å¥å­å¹³å‡é•·åº¦éé•· (${Math.round(avgSentenceLength)} å­—/å¥): ${file}`);
              warnings++;
            }
            
            if (headings.length === 0) {
              console.warn(`âš ï¸ ç¼ºå°‘æ¨™é¡Œçµæ§‹: ${file}`);
              warnings++;
              stats.structureIssues++;
            } else if (headings.length === 1) {
              console.warn(`âš ï¸ æ¨™é¡Œçµæ§‹éæ–¼ç°¡å–®: ${file}`);
              warnings++;
            }
            
            // æª¢æŸ¥åˆ—è¡¨ä½¿ç”¨
            const listPattern = /^[\s]*[-*+]\s+|^[\s]*\d+\.\s+/gm;
            const listItems = bodyContent.match(listPattern);
            const hasLists = listItems && listItems.length > 0;
            
            if (!hasLists && wordCount > 500) {
              console.warn(`âš ï¸ é•·å…§å®¹å»ºè­°ä½¿ç”¨åˆ—è¡¨æé«˜å¯è®€æ€§: ${file}`);
              warnings++;
            }
            
            console.log(`ğŸ“Š ${file}:`);
            console.log(`   å­—æ•¸: ${wordCount}, é–±è®€æ™‚é–“: ${readingTime} åˆ†é˜`);
            console.log(`   æ®µè½: ${paragraphs.length}, å¹³å‡é•·åº¦: ${Math.round(avgParagraphLength)} å­—`);
            console.log(`   å¥å­å¹³å‡é•·åº¦: ${Math.round(avgSentenceLength)} å­—`);
            console.log(`   æ¨™é¡Œ: ${headings.length} å€‹`);
          }
          
          stats.avgWordCount = Math.round(totalWords / files.length);
          stats.avgReadingTime = Math.ceil(stats.avgWordCount / 200);
          
          console.log(`\nğŸ“ˆ æ•´é«”çµ±è¨ˆ:`);
          console.log(`   æª”æ¡ˆç¸½æ•¸: ${stats.totalFiles}`);
          console.log(`   å¹³å‡å­—æ•¸: ${stats.avgWordCount}`);
          console.log(`   å¹³å‡é–±è®€æ™‚é–“: ${stats.avgReadingTime} åˆ†é˜`);
          console.log(`   çµæ§‹å•é¡Œ: ${stats.structureIssues} å€‹æª”æ¡ˆ`);
          console.log(`   ç¸½è­¦å‘Š: ${warnings} å€‹`);
          
          // è¨­å®šè­¦å‘Šé–¾å€¼
          if (warnings > files.length * 0.5) {
            console.warn(`\nâš ï¸ è­¦å‘Šæ•¸é‡è¼ƒå¤šï¼Œå»ºè­°æª¢æŸ¥å…§å®¹å“è³ª`);
          }
        }
        
        analyzeContent();
        EOF
        
        node analyze-content.js

  # ç”Ÿæˆé©—è­‰å ±å‘Š
  generate-validation-report:
    runs-on: ubuntu-latest
    name: ç”Ÿæˆé©—è­‰å ±å‘Š
    needs: [frontmatter-validation, markdown-validation, seo-accessibility-validation, medical-content-validation, content-structure-analysis]
    if: always()
    
    steps:
    - name: æª¢å‡ºç¨‹å¼ç¢¼
      uses: actions/checkout@v4
      
    - name: ç”Ÿæˆé©—è­‰å ±å‘Š
      run: |
        echo "ç”Ÿæˆé€²éšå…§å®¹é©—è­‰å ±å‘Š..."
        
        cat > validation-report.md << 'EOF'
        # é€²éšå…§å®¹é©—è­‰å ±å‘Š
        
        **ç”Ÿæˆæ™‚é–“**: $(date)
        **æäº¤**: ${{ github.sha }}
        **åˆ†æ”¯**: ${{ github.ref_name }}
        
        ## é©—è­‰çµæœæ‘˜è¦
        
        | æª¢æŸ¥é …ç›® | ç‹€æ…‹ |
        |---------|------|
        | Frontmatter æ ¼å¼é©—è­‰ | ${{ needs.frontmatter-validation.result == 'success' && 'âœ… é€šé' || 'âŒ å¤±æ•—' }} |
        | Markdown èªæ³•å’Œé€£çµé©—è­‰ | ${{ needs.markdown-validation.result == 'success' && 'âœ… é€šé' || 'âŒ å¤±æ•—' }} |
        | SEO å’Œç„¡éšœç¤™æ€§æª¢æŸ¥ | ${{ needs.seo-accessibility-validation.result == 'success' && 'âœ… é€šé' || 'âŒ å¤±æ•—' }} |
        | é†«ç™‚å…§å®¹ç‰¹å®šæª¢æŸ¥ | ${{ needs.medical-content-validation.result == 'success' && 'âœ… é€šé' || 'âŒ å¤±æ•—' }} |
        | å…§å®¹çµæ§‹å’Œå¯è®€æ€§åˆ†æ | ${{ needs.content-structure-analysis.result == 'success' && 'âœ… é€šé' || 'âŒ å¤±æ•—' }} |
        
        ## è©³ç´°èªªæ˜
        
        ### Frontmatter æ ¼å¼é©—è­‰
        - æª¢æŸ¥æ‰€æœ‰å¿…è¦æ¬„ä½æ˜¯å¦å­˜åœ¨
        - é©—è­‰æ¬„ä½æ ¼å¼å’Œå€¼çš„æœ‰æ•ˆæ€§
        - ç¢ºä¿å°ˆç§‘åˆ†é¡æ­£ç¢º
        - é©—è­‰æ—¥æœŸæ ¼å¼
        
        ### Markdown èªæ³•å’Œé€£çµé©—è­‰
        - ä½¿ç”¨ markdownlint æª¢æŸ¥èªæ³•è¦ç¯„
        - é©—è­‰å…§éƒ¨é€£çµæ ¼å¼
        - æª¢æŸ¥å¤–éƒ¨é€£çµæœ‰æ•ˆæ€§
        - ç¢ºä¿é€£çµæ–‡å­—æè¿°æ€§
        
        ### SEO å’Œç„¡éšœç¤™æ€§æª¢æŸ¥
        - æ¨™é¡Œå’Œæè¿°é•·åº¦å„ªåŒ–
        - åœ–ç‰‡ alt æ–‡å­—æª¢æŸ¥
        - æ¨™é¡Œå±¤ç´šçµæ§‹é©—è­‰
        - é€£çµå¯è¨ªå•æ€§æª¢æŸ¥
        
        ### é†«ç™‚å…§å®¹ç‰¹å®šæª¢æŸ¥
        - å¿…è¦é†«ç™‚ç« ç¯€æª¢æŸ¥
        - å±éšªé†«ç™‚å»ºè­°è©å½™æƒæ
        - è—¥ç‰©åŠ‘é‡æ ¼å¼é©—è­‰
        - é†«ç™‚å…è²¬è²æ˜æª¢æŸ¥
        
        ### å…§å®¹çµæ§‹å’Œå¯è®€æ€§åˆ†æ
        - å­—æ•¸å’Œé–±è®€æ™‚é–“çµ±è¨ˆ
        - æ®µè½å’Œå¥å­é•·åº¦åˆ†æ
        - æ¨™é¡Œçµæ§‹è©•ä¼°
        - åˆ—è¡¨ä½¿ç”¨å»ºè­°
        
        ## å»ºè­°æ”¹å–„äº‹é …
        
        å¦‚æœ‰æª¢æŸ¥å¤±æ•—ï¼Œè«‹åƒè€ƒä¸Šè¿°å„é …æª¢æŸ¥çš„å…·é«”éŒ¯èª¤è¨Šæ¯é€²è¡Œä¿®æ­£ã€‚
        
        ---
        
        *æ­¤å ±å‘Šç”± GitHub Actions è‡ªå‹•ç”Ÿæˆ*
        EOF
        
        echo "é©—è­‰å ±å‘Šå·²ç”Ÿæˆ"
        
    - name: ä¸Šå‚³é©—è­‰å ±å‘Š
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: validation-report
        path: validation-report.md
        retention-days: 30