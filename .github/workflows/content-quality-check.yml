name: ðŸ“‹ å…§å®¹å“è³ªæª¢æŸ¥

on:
  pull_request:
    branches: [ main, master ]
    paths:
      - 'src/content/**/*.md'
      - 'src/content/medical-specialties/**'
      - 'src/content/templates/**'
  push:
    branches: [ main, master ]
    paths:
      - 'src/content/**/*.md'

# å…è¨±æ‰‹å‹•è§¸ç™¼
  workflow_dispatch:
    inputs:
      content_path:
        description: 'æŒ‡å®šæª¢æŸ¥çš„å…§å®¹è·¯å¾‘'
        required: false
        default: 'src/content/education'

jobs:
  # åŸºç¤Žé©—è­‰å·¥ä½œ
  basic-validation:
    runs-on: ubuntu-latest
    name: ðŸ” åŸºç¤Žå…§å®¹é©—è­‰
    outputs:
      has-content-changes: ${{ steps.changes.outputs.content }}
      changed-files: ${{ steps.changes.outputs.content_files }}
    
    steps:
    - name: æª¢å‡ºç¨‹å¼ç¢¼
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: æª¢æ¸¬è®Šæ›´æª”æ¡ˆ
      uses: dorny/paths-filter@v2
      id: changes
      with:
        filters: |
          content:
            - 'src/content/**/*.md'
          config:
            - 'src/content/config.ts'
            - 'src/content/medical-specialties/**'
          templates:
            - 'src/content/templates/**'
        list-files: json

    - name: è¨­å®š Node.js
      if: steps.changes.outputs.content == 'true'
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'

    - name: å®‰è£ä¾è³´
      if: steps.changes.outputs.content == 'true'
      run: npm ci

    - name: é©—è­‰ Content Collections Schema
      if: steps.changes.outputs.content == 'true'
      run: |
        echo "ðŸ” é©—è­‰ Astro Content Collections..."
        npm run astro check
        echo "âœ… Content Collections é©—è­‰é€šéŽ"

    - name: æª¢æŸ¥ Frontmatter æ ¼å¼
      if: steps.changes.outputs.content == 'true'
      run: |
        echo "ðŸ“‹ æª¢æŸ¥ Frontmatter æ ¼å¼..."
        
        # æª¢æŸ¥æ‰€æœ‰è®Šæ›´çš„ markdown æª”æ¡ˆ
        echo '${{ steps.changes.outputs.content_files }}' | jq -r '.[]' | while read file; do
          if [[ -f "$file" ]]; then
            echo "æª¢æŸ¥æª”æ¡ˆ: $file"
            
            # æª¢æŸ¥æ˜¯å¦æœ‰ frontmatter
            if ! head -n 10 "$file" | grep -q "^---$"; then
              echo "âŒ $file: ç¼ºå°‘ frontmatter"
              exit 1
            fi
            
            # æª¢æŸ¥å¿…è¦æ¬„ä½
            if ! grep -q "^title:" "$file"; then
              echo "âŒ $file: ç¼ºå°‘ title æ¬„ä½"
              exit 1
            fi
            
            if ! grep -q "^specialty:" "$file"; then
              echo "âŒ $file: ç¼ºå°‘ specialty æ¬„ä½"
              exit 1
            fi
            
            echo "âœ… $file: Frontmatter æ ¼å¼æ­£ç¢º"
          fi
        done

  # é†«ç™‚è¡“èªžæª¢æŸ¥
  terminology-check:
    runs-on: ubuntu-latest
    needs: basic-validation
    if: needs.basic-validation.outputs.has-content-changes == 'true'
    name: ðŸ¥ é†«ç™‚è¡“èªžæª¢æŸ¥
    
    steps:
    - name: æª¢å‡ºç¨‹å¼ç¢¼
      uses: actions/checkout@v4

    - name: è¨­å®š Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'

    - name: å®‰è£ä¾è³´
      run: npm ci

    - name: åŸ·è¡Œé†«ç™‚è¡“èªžæª¢æŸ¥
      run: |
        echo "ðŸ” é–‹å§‹é†«ç™‚è¡“èªžæª¢æŸ¥..."
        npm run quality:terminology
        echo "âœ… é†«ç™‚è¡“èªžæª¢æŸ¥å®Œæˆ"

    - name: ä¸Šå‚³è¡“èªžæª¢æŸ¥å ±å‘Š
      if: always()
      uses: actions/upload-artifact@v3
      with:
        name: terminology-report
        path: medical-terminology-report.json
        retention-days: 30

  # ç„¡éšœç¤™æ€§é©—è­‰
  accessibility-check:
    runs-on: ubuntu-latest
    needs: basic-validation
    if: needs.basic-validation.outputs.has-content-changes == 'true'
    name: â™¿ ç„¡éšœç¤™æ€§é©—è­‰
    
    steps:
    - name: æª¢å‡ºç¨‹å¼ç¢¼
      uses: actions/checkout@v4

    - name: è¨­å®š Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'

    - name: å®‰è£ä¾è³´
      run: npm ci

    - name: åŸ·è¡Œç„¡éšœç¤™æ€§é©—è­‰
      run: |
        echo "â™¿ é–‹å§‹ç„¡éšœç¤™æ€§é©—è­‰..."
        npm run quality:accessibility
        echo "âœ… ç„¡éšœç¤™æ€§é©—è­‰å®Œæˆ"

    - name: ä¸Šå‚³ç„¡éšœç¤™æ€§å ±å‘Š
      if: always()
      uses: actions/upload-artifact@v3
      with:
        name: accessibility-report
        path: accessibility-report.json
        retention-days: 30

  # å¯è®€æ€§åˆ†æž
  readability-check:
    runs-on: ubuntu-latest
    needs: basic-validation
    if: needs.basic-validation.outputs.has-content-changes == 'true'
    name: ðŸ“– å¯è®€æ€§åˆ†æž
    
    steps:
    - name: æª¢å‡ºç¨‹å¼ç¢¼
      uses: actions/checkout@v4

    - name: è¨­å®š Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'

    - name: å®‰è£ä¾è³´
      run: npm ci

    - name: åŸ·è¡Œå¯è®€æ€§åˆ†æž
      run: |
        echo "ðŸ“– é–‹å§‹å¯è®€æ€§åˆ†æž..."
        npm run quality:readability
        echo "âœ… å¯è®€æ€§åˆ†æžå®Œæˆ"

    - name: ä¸Šå‚³å¯è®€æ€§å ±å‘Š
      if: always()
      uses: actions/upload-artifact@v3
      with:
        name: readability-report
        path: readability-report.json
        retention-days: 30

  # åƒè€ƒæ–‡ç»æª¢æŸ¥
  references-check:
    runs-on: ubuntu-latest
    needs: basic-validation
    if: needs.basic-validation.outputs.has-content-changes == 'true'
    name: ðŸ“š åƒè€ƒæ–‡ç»æª¢æŸ¥
    
    steps:
    - name: æª¢å‡ºç¨‹å¼ç¢¼
      uses: actions/checkout@v4

    - name: è¨­å®š Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'

    - name: å®‰è£ä¾è³´
      run: npm ci

    - name: åŸ·è¡Œåƒè€ƒæ–‡ç»æª¢æŸ¥
      run: |
        echo "ðŸ“š é–‹å§‹åƒè€ƒæ–‡ç»æª¢æŸ¥..."
        npm run quality:references
        echo "âœ… åƒè€ƒæ–‡ç»æª¢æŸ¥å®Œæˆ"

    - name: ä¸Šå‚³åƒè€ƒæ–‡ç»å ±å‘Š
      if: always()
      uses: actions/upload-artifact@v3
      with:
        name: references-report
        path: reference-format-report.json
        retention-days: 30

  # Markdown èªžæ³•æª¢æŸ¥
  markdown-lint:
    runs-on: ubuntu-latest
    needs: basic-validation
    if: needs.basic-validation.outputs.has-content-changes == 'true'
    name: ðŸ“ Markdown èªžæ³•æª¢æŸ¥
    
    steps:
    - name: æª¢å‡ºç¨‹å¼ç¢¼
      uses: actions/checkout@v4

    - name: è¨­å®š Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'

    - name: å®‰è£ä¾è³´
      run: npm ci

    - name: åŸ·è¡Œ Markdown èªžæ³•æª¢æŸ¥
      run: |
        echo "ðŸ“ é–‹å§‹ Markdown èªžæ³•æª¢æŸ¥..."
        npm run lint:md
        echo "âœ… Markdown èªžæ³•æª¢æŸ¥å®Œæˆ"

  # ç¶œåˆå“è³ªæª¢æŸ¥
  comprehensive-quality-check:
    runs-on: ubuntu-latest
    needs: [basic-validation, terminology-check, accessibility-check, readability-check, references-check, markdown-lint]
    if: always() && needs.basic-validation.outputs.has-content-changes == 'true'
    name: ðŸŽ¯ ç¶œåˆå“è³ªè©•ä¼°
    
    steps:
    - name: æª¢å‡ºç¨‹å¼ç¢¼
      uses: actions/checkout@v4

    - name: è¨­å®š Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'

    - name: å®‰è£ä¾è³´
      run: npm ci

    - name: ä¸‹è¼‰æ‰€æœ‰æª¢æŸ¥å ±å‘Š
      uses: actions/download-artifact@v3
      with:
        path: ./reports

    - name: åŸ·è¡Œç¶œåˆå“è³ªæª¢æŸ¥
      run: |
        echo "ðŸŽ¯ é–‹å§‹ç¶œåˆå“è³ªè©•ä¼°..."
        
        # å»ºç«‹å ±å‘Šç›®éŒ„
        mkdir -p quality-reports
        
        # è¤‡è£½å€‹åˆ¥å ±å‘Šåˆ°çµ±ä¸€ç›®éŒ„
        find ./reports -name "*.json" -exec cp {} quality-reports/ \;
        
        # åŸ·è¡Œç¶œåˆå“è³ªæª¢æŸ¥
        npm run quality:check
        echo "âœ… ç¶œåˆå“è³ªè©•ä¼°å®Œæˆ"

    - name: ä¸Šå‚³ç¶œåˆå“è³ªå ±å‘Š
      if: always()
      uses: actions/upload-artifact@v3
      with:
        name: comprehensive-quality-report
        path: quality-reports/
        retention-days: 30

    - name: ç”Ÿæˆå“è³ªæª¢æŸ¥æ‘˜è¦
      if: always()
      run: |
        echo "## ðŸ“Š å…§å®¹å“è³ªæª¢æŸ¥æ‘˜è¦" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        
        # æª¢æŸ¥å„é …æª¢æŸ¥çµæžœ
        echo "### æª¢æŸ¥çµæžœ" >> $GITHUB_STEP_SUMMARY
        echo "| æª¢æŸ¥é …ç›® | ç‹€æ…‹ | è©³æƒ… |" >> $GITHUB_STEP_SUMMARY
        echo "|---------|------|------|" >> $GITHUB_STEP_SUMMARY
        
        # åŸºç¤Žé©—è­‰
        if [ "${{ needs.basic-validation.result }}" = "success" ]; then
          echo "| åŸºç¤Žé©—è­‰ | âœ… é€šéŽ | Content Collections å’Œ Frontmatter æ ¼å¼æ­£ç¢º |" >> $GITHUB_STEP_SUMMARY
        else
          echo "| åŸºç¤Žé©—è­‰ | âŒ å¤±æ•— | è«‹æª¢æŸ¥ Content Collections æˆ– Frontmatter æ ¼å¼ |" >> $GITHUB_STEP_SUMMARY
        fi
        
        # é†«ç™‚è¡“èªžæª¢æŸ¥
        if [ "${{ needs.terminology-check.result }}" = "success" ]; then
          echo "| é†«ç™‚è¡“èªžæª¢æŸ¥ | âœ… é€šéŽ | è¡“èªžä½¿ç”¨æ­£ç¢º |" >> $GITHUB_STEP_SUMMARY
        else
          echo "| é†«ç™‚è¡“èªžæª¢æŸ¥ | âŒ å¤±æ•— | ç™¼ç¾è¡“èªžå•é¡Œï¼Œè«‹æŸ¥çœ‹è©³ç´°å ±å‘Š |" >> $GITHUB_STEP_SUMMARY
        fi
        
        # ç„¡éšœç¤™æ€§é©—è­‰
        if [ "${{ needs.accessibility-check.result }}" = "success" ]; then
          echo "| ç„¡éšœç¤™æ€§é©—è­‰ | âœ… é€šéŽ | ç¬¦åˆç„¡éšœç¤™æ€§æ¨™æº– |" >> $GITHUB_STEP_SUMMARY
        else
          echo "| ç„¡éšœç¤™æ€§é©—è­‰ | âŒ å¤±æ•— | ç™¼ç¾ç„¡éšœç¤™æ€§å•é¡Œ |" >> $GITHUB_STEP_SUMMARY
        fi
        
        # å¯è®€æ€§åˆ†æž
        if [ "${{ needs.readability-check.result }}" = "success" ]; then
          echo "| å¯è®€æ€§åˆ†æž | âœ… é€šéŽ | å…§å®¹å¯è®€æ€§è‰¯å¥½ |" >> $GITHUB_STEP_SUMMARY
        else
          echo "| å¯è®€æ€§åˆ†æž | âš ï¸ è­¦å‘Š | å¯è®€æ€§éœ€è¦æ”¹å–„ |" >> $GITHUB_STEP_SUMMARY
        fi
        
        # åƒè€ƒæ–‡ç»æª¢æŸ¥
        if [ "${{ needs.references-check.result }}" = "success" ]; then
          echo "| åƒè€ƒæ–‡ç»æª¢æŸ¥ | âœ… é€šéŽ | åƒè€ƒæ–‡ç»æ ¼å¼æ­£ç¢º |" >> $GITHUB_STEP_SUMMARY
        else
          echo "| åƒè€ƒæ–‡ç»æª¢æŸ¥ | âŒ å¤±æ•— | åƒè€ƒæ–‡ç»æ ¼å¼éœ€è¦ä¿®æ­£ |" >> $GITHUB_STEP_SUMMARY
        fi
        
        # Markdown èªžæ³•æª¢æŸ¥
        if [ "${{ needs.markdown-lint.result }}" = "success" ]; then
          echo "| Markdown èªžæ³• | âœ… é€šéŽ | èªžæ³•æ ¼å¼æ­£ç¢º |" >> $GITHUB_STEP_SUMMARY
        else
          echo "| Markdown èªžæ³• | âŒ å¤±æ•— | ç™¼ç¾èªžæ³•éŒ¯èª¤ |" >> $GITHUB_STEP_SUMMARY
        fi
        
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### ðŸ“„ è©³ç´°å ±å‘Š" >> $GITHUB_STEP_SUMMARY
        echo "è«‹æŸ¥çœ‹ Actions ç”¢å‡ºçš„ Artifacts ä»¥ç²å–è©³ç´°çš„å“è³ªæª¢æŸ¥å ±å‘Šã€‚" >> $GITHUB_STEP_SUMMARY
        
        # å¦‚æžœæ˜¯ PRï¼Œæ·»åŠ å¯©æ ¸å»ºè­°
        if [ "${{ github.event_name }}" = "pull_request" ]; then
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ‘¥ å¯©æ ¸å»ºè­°" >> $GITHUB_STEP_SUMMARY
          echo "- è«‹é†«ç™‚å°ˆæ¥­å¯©æ ¸è€…æª¢æŸ¥å…§å®¹æº–ç¢ºæ€§" >> $GITHUB_STEP_SUMMARY
          echo "- è«‹å…§å®¹ç·¨è¼¯è€…æª¢æŸ¥èªžè¨€è¡¨é”å’Œæ ¼å¼" >> $GITHUB_STEP_SUMMARY
          echo "- è«‹æŠ€è¡“å¯©æ ¸è€…ç¢ºèªæ‰€æœ‰è‡ªå‹•åŒ–æª¢æŸ¥é€šéŽ" >> $GITHUB_STEP_SUMMARY
        fi

  # PR è©•è«–å’Œæ¨™ç±¤
  pr-feedback:
    runs-on: ubuntu-latest
    needs: [basic-validation, terminology-check, accessibility-check, readability-check, references-check, markdown-lint, comprehensive-quality-check]
    if: always() && github.event_name == 'pull_request' && needs.basic-validation.outputs.has-content-changes == 'true'
    name: ðŸ’¬ PR å›žé¥‹å’Œæ¨™ç±¤
    
    steps:
    - name: æª¢å‡ºç¨‹å¼ç¢¼
      uses: actions/checkout@v4

    - name: ä¸‹è¼‰ç¶œåˆå“è³ªå ±å‘Š
      uses: actions/download-artifact@v3
      with:
        name: comprehensive-quality-report
        path: ./quality-reports

    - name: ç”Ÿæˆ PR è©•è«–
      uses: actions/github-script@v6
      with:
        script: |
          const fs = require('fs');
          
          // è®€å–å“è³ªæª¢æŸ¥çµæžœ
          let qualityScore = 0;
          let reportSummary = '';
          
          try {
            const reportPath = './quality-reports/comprehensive-quality-report.json';
            if (fs.existsSync(reportPath)) {
              const report = JSON.parse(fs.readFileSync(reportPath, 'utf8'));
              qualityScore = report.overallScore || 0;
              reportSummary = `ç¸½é«”å“è³ªåˆ†æ•¸: ${qualityScore}/100 (${report.qualityLevel?.label || 'æœªçŸ¥'})`;
            }
          } catch (error) {
            console.log('ç„¡æ³•è®€å–å“è³ªå ±å‘Š:', error);
          }
          
          // å»ºç«‹è©•è«–å…§å®¹
          const comment = `## ðŸ¥ é†«ç™‚å…§å®¹å“è³ªæª¢æŸ¥çµæžœ
          
          ${reportSummary}
          
          ### ðŸ“‹ æª¢æŸ¥çµæžœæ‘˜è¦
          
          | æª¢æŸ¥é …ç›® | ç‹€æ…‹ |
          |---------|------|
          | åŸºç¤Žé©—è­‰ | ${{ needs.basic-validation.result == 'success' ? 'âœ… é€šéŽ' : 'âŒ å¤±æ•—' }} |
          | é†«ç™‚è¡“èªžæª¢æŸ¥ | ${{ needs.terminology-check.result == 'success' ? 'âœ… é€šéŽ' : 'âŒ å¤±æ•—' }} |
          | ç„¡éšœç¤™æ€§é©—è­‰ | ${{ needs.accessibility-check.result == 'success' ? 'âœ… é€šéŽ' : 'âŒ å¤±æ•—' }} |
          | å¯è®€æ€§åˆ†æž | ${{ needs.readability-check.result == 'success' ? 'âœ… é€šéŽ' : 'âš ï¸ éœ€æ”¹å–„' }} |
          | åƒè€ƒæ–‡ç»æª¢æŸ¥ | ${{ needs.references-check.result == 'success' ? 'âœ… é€šéŽ' : 'âŒ å¤±æ•—' }} |
          | Markdown èªžæ³• | ${{ needs.markdown-lint.result == 'success' ? 'âœ… é€šéŽ' : 'âŒ å¤±æ•—' }} |
          
          ### ðŸ“Š å“è³ªè©•ä¼°
          
          ${qualityScore >= 90 ? 'ðŸ† **å„ªç§€**: å…§å®¹å“è³ªæ¥µä½³ï¼Œç¬¦åˆæ‰€æœ‰æ¨™æº–' :
            qualityScore >= 75 ? 'âœ… **è‰¯å¥½**: å…§å®¹å“è³ªè‰¯å¥½ï¼Œæœ‰å°‘é‡æ”¹å–„ç©ºé–“' :
            qualityScore >= 60 ? 'âš ï¸ **æ™®é€š**: å…§å®¹å“è³ªæ™®é€šï¼Œéœ€è¦ä¸€äº›æ”¹å–„' :
            'âŒ **éœ€æ”¹å–„**: å…§å®¹å“è³ªéœ€è¦å¤§å¹…æ”¹å–„'}
          
          ### ðŸ“„ è©³ç´°å ±å‘Š
          
          è«‹æŸ¥çœ‹ GitHub Actions çš„ Artifacts éƒ¨åˆ†ä¸‹è¼‰è©³ç´°çš„å“è³ªæª¢æŸ¥å ±å‘Šã€‚
          
          ### ðŸ‘¥ å¯©æ ¸å»ºè­°
          
          - ðŸ¥ **é†«ç™‚å¯©æ ¸**: è«‹ç›¸é—œå°ˆç§‘é†«å¸«å¯©æ ¸å…§å®¹æº–ç¢ºæ€§
          - ðŸ“ **ç·¨è¼¯å¯©æ ¸**: è«‹å…§å®¹ç·¨è¼¯è€…æª¢æŸ¥èªžè¨€è¡¨é”å’Œæ ¼å¼
          - ðŸ”§ **æŠ€è¡“å¯©æ ¸**: è«‹ç¢ºèªæ‰€æœ‰è‡ªå‹•åŒ–æª¢æŸ¥é€šéŽ
          
          ---
          
          *æ­¤è©•è«–ç”±è‡ªå‹•åŒ–å“è³ªæª¢æŸ¥ç³»çµ±ç”Ÿæˆ ðŸ¤–*`;
          
          // ç™¼å¸ƒè©•è«–
          github.rest.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: comment
          });

    - name: æ·»åŠ  PR æ¨™ç±¤
      uses: actions/github-script@v6
      with:
        script: |
          const labels = ['content-quality-checked'];
          
          // æ ¹æ“šæª¢æŸ¥çµæžœæ·»åŠ æ¨™ç±¤
          if ('${{ needs.basic-validation.result }}' !== 'success') {
            labels.push('needs-basic-fixes');
          }
          
          if ('${{ needs.terminology-check.result }}' !== 'success') {
            labels.push('needs-medical-review');
          }
          
          if ('${{ needs.accessibility-check.result }}' !== 'success') {
            labels.push('needs-accessibility-fixes');
          }
          
          if ('${{ needs.references-check.result }}' !== 'success') {
            labels.push('needs-reference-fixes');
          }
          
          if ('${{ needs.markdown-lint.result }}' !== 'success') {
            labels.push('needs-format-fixes');
          }
          
          // æ·»åŠ å“è³ªç­‰ç´šæ¨™ç±¤
          try {
            const fs = require('fs');
            const reportPath = './quality-reports/comprehensive-quality-report.json';
            if (fs.existsSync(reportPath)) {
              const report = JSON.parse(fs.readFileSync(reportPath, 'utf8'));
              const score = report.overallScore || 0;
              
              if (score >= 90) labels.push('quality-excellent');
              else if (score >= 75) labels.push('quality-good');
              else if (score >= 60) labels.push('quality-fair');
              else labels.push('quality-needs-improvement');
            }
          } catch (error) {
            console.log('ç„¡æ³•è®€å–å“è³ªå ±å‘Š:', error);
          }
          
          // æ‡‰ç”¨æ¨™ç±¤
          github.rest.issues.addLabels({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            labels: labels
          });

  # é€šçŸ¥ç›¸é—œäººå“¡
  notify-reviewers:
    runs-on: ubuntu-latest
    needs: [comprehensive-quality-check]
    if: always() && github.event_name == 'pull_request' && needs.basic-validation.outputs.has-content-changes == 'true'
    name: ðŸ“¢ é€šçŸ¥å¯©æ ¸è€…
    
    steps:
    - name: é€šçŸ¥å°ˆç§‘å¯©æ ¸è€…
      uses: actions/github-script@v6
      with:
        script: |
          // æ ¹æ“šè®Šæ›´çš„æª”æ¡ˆå…§å®¹åˆ¤æ–·éœ€è¦é€šçŸ¥çš„å°ˆç§‘å¯©æ ¸è€…
          const changedFiles = ${{ needs.basic-validation.outputs.changed-files }};
          const reviewers = new Set();
          
          changedFiles.forEach(file => {
            if (file.includes('cardiology')) reviewers.add('cardiology-reviewer');
            if (file.includes('neurology')) reviewers.add('neurology-reviewer');
            if (file.includes('pediatrics')) reviewers.add('pediatrics-reviewer');
            if (file.includes('emergency')) reviewers.add('emergency-reviewer');
            if (file.includes('orthopedics')) reviewers.add('orthopedics-reviewer');
          });
          
          // ç¸½æ˜¯æ·»åŠ ä¸€èˆ¬é†«ç™‚å¯©æ ¸è€…
          reviewers.add('medical-advisors');
          reviewers.add('content-manager');
          
          if (reviewers.size > 0) {
            github.rest.pulls.requestReviewers({
              pull_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              reviewers: Array.from(reviewers)
            });
          }