# 醫療工具導航測試修復計畫

## 測試結果分析

### 成功的測試
- 19 個測試通過，主要在 Chromium 瀏覽器上
- 基本的頁面載入和內容顯示功能正常

### 失敗的測試問題

#### 1. 選擇器衝突問題
**問題**: `locator('h1') resolved to 4 elements` - 頁面上有多個 h1 元素
**影響**: 無法準確定位到正確的標題元素
**解決方案**: 使用更具體的選擇器

#### 2. 計算機卡片點擊問題
**問題**: 無法點擊某些計算機的導航卡片，特別是 "BMI 計算器"
**影響**: 導航功能失效
**可能原因**:
- 卡片元素沒有正確的 ID 或 data 屬性
- 連結元素不可點擊
- 頁面載入時機問題

#### 3. 連接被拒絕錯誤
**問題**: `NS_ERROR_CONNECTION_REFUSED` 在某些測試中出現
**影響**: 頁面無法載入
**可能原因**: 開發伺服器不穩定或測試執行時機問題

## 修復計畫

### 階段 1: 改善頁面結構和選擇器

1. **為計算機卡片添加更好的測試屬性**
   - 在 `/tools` 頁面中為每個計算機卡片添加 `data-testid` 屬性
   - 確保每個卡片都有唯一的識別符

2. **修復 h1 選擇器衝突**
   - 使用更具體的選擇器來定位主要標題
   - 避免使用通用的 `h1` 選擇器

### 階段 2: 改善測試穩定性

1. **增加等待機制**
   - 在關鍵操作前添加適當的等待
   - 使用 `waitForLoadState` 確保頁面完全載入

2. **改善錯誤處理**
   - 添加重試機制
   - 改善錯誤訊息和除錯資訊

### 階段 3: 簡化測試配置

1. **減少測試瀏覽器數量**
   - 先專注於 Chromium 測試
   - 確保核心功能正常後再擴展到其他瀏覽器

2. **改善測試隔離**
   - 確保每個測試都是獨立的
   - 避免測試之間的相互影響

## 實施步驟

### 步驟 1: 修復頁面結構
- 在 `src/pages/tools/index.astro` 中添加測試屬性
- 確保每個計算機卡片都有正確的連結和識別符

### 步驟 2: 更新測試代碼
- 修改選擇器策略
- 改善等待和錯誤處理機制
- 簡化測試配置

### 步驟 3: 驗證修復
- 運行簡化的測試套件
- 確認所有計算機都可以正確導航
- 逐步擴展測試覆蓋範圍

## 預期結果

修復完成後，應該能夠：
1. 從 `/tools` 頁面成功導航到所有 6 個計算機
2. 所有計算機卡片都能正確顯示和點擊
3. 測試在不同瀏覽器上都能穩定運行
4. 提供清晰的錯誤訊息和除錯資訊

## 風險評估

- **低風險**: 頁面結構修改（只是添加測試屬性）
- **中風險**: 測試代碼重構（可能需要多次迭代）
- **高風險**: 開發伺服器穩定性問題（可能需要基礎設施調整）