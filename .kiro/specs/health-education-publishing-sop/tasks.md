# 實作計畫

## 專案結構概述

本 SOP 系統採用「前端優先」的實現方式，以 Git 工作流程為核心：

1. **核心機制**：使用 GitHub Pull Request 作為審核流程
2. **狀態管理**：透過 Markdown Frontmatter 的 `status` 欄位控制
3. **內容驗證**：使用 Astro Content Collections + Zod Schema
4. **自動化**：GitHub Actions 進行品質檢查和自動部署

## 實作任務

### 階段一：基於 Git 的 SOP 工作流程建立

- [ ] 1. 擴展 Astro Content Collections Schema

  - 更新 `src/content/config.ts` 加入 SOP 工作流程欄位
  - 定義 `status` 枚舉（draft, in-review, published）
  - 加入 `reviewers`、`qualityChecks`、`version` 等欄位
  - 建立專科特定的驗證規則
  - _需求: 1.1, 2.1, 4.1_

- [ ] 2. 設定 Decap CMS (Netlify CMS) 整合

  - 安裝和配置 Decap CMS 套件
  - 建立 `public/admin/config.yml` 配置檔案
  - 設定 GitHub OAuth 認證和權限
  - 配置 CMS 管理介面路由 (`/admin`)
  - _需求: 2.1, 2.2, 3.1_

- [ ] 3. 建立醫學專科分類資料結構

  - 在 `src/content/medical-specialties/` 建立專科 JSON 檔案
  - 定義每個專科的審核者清單和要求
  - 設定專科特定的內容模板和檢查清單
  - 在 Decap CMS 中配置專科選擇器
  - _需求: 1.1, 1.4_

- [ ] 4. 設計 Decap CMS 的衛教文章編輯介面

  - 配置文章 collection 的欄位和驗證
  - 設定多語言內容編輯器
  - 建立專科特定的欄位和模板
  - 配置圖片上傳和媒體管理
  - _需求: 2.1, 2.2, 7.1_

- [ ] 5. 建立內容模板和編輯器預設值

  - 為每個專科建立 CMS 模板
  - 設定 Frontmatter 預設值和選項
  - 建立內容撰寫指南和幫助文字
  - 配置編輯器工具列和快捷功能
  - _需求: 2.1, 2.2_

- [ ] 6. 設定 GitHub 工作流程和權限

  - 配置 GitHub 分支保護規則
  - 設定 PR 模板和審核要求
  - 建立 CODEOWNERS 檔案分配審核者
  - 設定專科特定的審核者群組
  - _需求: 3.1, 3.2, 3.3_

- [ ] 7. 建立 GitHub Actions 自動化檢查

  - 實作 Frontmatter 格式驗證
  - 建立內容結構和必要欄位檢查
  - 設定 Markdown 語法和連結驗證
  - 實作基本的 SEO 和無障礙性檢查
  - _需求: 4.1, 4.2, 4.3_

- [ ] 8. 開發品質檢查工具

  - 建立醫療術語和拼寫檢查腳本
  - 實作圖片 alt 文字和無障礙性驗證
  - 設計內容長度和可讀性分析
  - 建立參考文獻格式檢查
  - _需求: 4.1, 4.2_

- [ ] 9. 建立 PR 模板和檢查清單

  - 設計專科特定的 PR 模板
  - 建立審核檢查清單（醫療準確性、SEO 等）
  - 實作自動化的 PR 標籤和分類
  - 設定 PR 狀態追蹤和通知
  - _需求: 3.2, 3.4_

- [ ] 10. 實作內容預覽和測試環境
  - 設定 Cloudflare Pages 的 PR 預覽功能
  - 建立審核者專用的預覽介面
  - 實作內容變更的視覺化比較
  - 設定測試資料和範例內容
  - _需求: 2.4, 5.3_

### 階段二：前端展示系統優化

- [ ] 11. 更新現有 Astro 頁面和組件

  - 修改 `src/pages/education/` 頁面過濾已發布內容
  - 更新專科分類頁面顯示文章統計
  - 調整文章詳細頁面顯示版本和作者資訊
  - 優化 SEO 元資料和結構化資料
  - _需求: 7.1, 8.3_

- [ ] 12. 建立內容狀態指示器

  - 在開發環境顯示文章狀態（draft, in-review）
  - 建立審核進度指示器
  - 實作內容新鮮度和更新提醒
  - 設計版本歷史展示介面
  - _需求: 6.1, 6.2_

- [ ] 13. 實作內容搜尋和過濾功能

  - 建立按專科、狀態、作者的過濾器
  - 實作全文搜尋功能
  - 設計標籤和分類導覽
  - 建立相關文章推薦系統
  - _需求: 1.1, 7.1_

- [ ] 14. 優化多語言支援

  - 確保所有 SOP 相關欄位支援多語言
  - 建立語言切換時的狀態保持
  - 實作多語言內容同步檢查
  - 設計翻譯狀態追蹤
  - _需求: 7.1, 7.2_

- [ ] 15. 建立管理者工具頁面

  - 建立內容統計和分析儀表板（建置時分析 `src/content/` 生成靜態報告）
  - 實作審核進度追蹤頁面（基於 GitHub API 獲取 PR 狀態）
  - 設計內容品質報告展示（整合 GitHub Actions 檢查結果）
  - 建立快速操作和批次處理工具（連結到 Decap CMS 和 GitHub）
  - _需求: 8.1, 8.2_

- [ ] 16. 實作效能監控和分析
  - 建立頁面載入時間追蹤
  - 實作使用者行為分析
  - 設定內容互動指標監控
  - 建立 SEO 效能追蹤
  - _需求: 8.3, 8.4_

### 階段三：測試和文件化

- [ ] 17. 建立自動化測試套件

  - 撰寫 Content Collections schema 驗證測試
  - 建立 GitHub Actions 工作流程測試
  - 實作內容品質檢查的單元測試
  - 設定端到端的發布流程測試
  - _需求: 所有需求的測試覆蓋_

- [ ] 18. 建立完整的工作流程測試

  - 模擬完整的文章撰寫到發布流程（包含 Decap CMS）
  - 測試不同專科的審核流程
  - 驗證權限控制和分支保護
  - 測試錯誤處理和回復機制
  - _需求: 所有需求的整合測試_

- [ ] 19. 撰寫使用者文件和指南

  - 建立 Decap CMS 使用手冊（如何登入、編輯、發布）
  - 撰寫審核者指南（如何在 GitHub 審核、使用檢查清單）
  - 製作管理者手冊（如何管理權限、監控流程）
  - 建立故障排除和常見問題解答
  - _需求: 所有需求的文件化_

- [ ] 20. 建立培訓材料和範例
  - 製作 Decap CMS 操作的視頻教學
  - 建立實際操作的練習範例
  - 設計新人入職培訓流程
  - 建立最佳實踐和風格指南
  - _需求: 2.1, 3.1, 4.1_

### 階段四：上線和持續改善

- [ ] 21. 準備生產環境配置

  - 設定 GitHub 儲存庫的分支保護和權限
  - 配置 Cloudflare Pages 的自動部署
  - 建立生產環境的環境變數和設定
  - 設定監控和警報系統
  - _需求: 系統安全性和可靠性_

- [ ] 22. 執行內容遷移和初始化

  - 將現有衛教文章轉換為新格式
  - 設定初始的專科分類和審核者
  - 在 Decap CMS 中建立範例內容和測試資料
  - 驗證所有內容的格式正確性
  - _需求: 1.1, 2.1, 6.1_

- [ ] 23. 進行使用者驗收測試

  - 與內容團隊進行 Decap CMS 實際操作測試
  - 收集使用者回饋和改善建議
  - 調整工作流程和檢查清單
  - 驗證效能和使用體驗
  - _需求: 所有需求的使用者驗證_

- [ ] 24. 正式上線和監控
  - 執行正式的工作流程切換
  - 監控系統使用情況和效能
  - 建立持續改善和回饋機制
  - 規劃未來後端系統的遷移路徑
  - _需求: 8.3, 8.4_

## 技術棧總結

### 核心技術

- **框架**: Astro (現有專案)
- **內容管理**: Decap CMS + Content Collections + Zod Schema
- **編輯介面**: Decap CMS 視覺化編輯器
- **版本控制**: Git + GitHub
- **工作流程**: GitHub Pull Request + Actions
- **部署**: Cloudflare Pages (自動部署)

### 自動化工具

- **品質檢查**: GitHub Actions + 自定義腳本
- **內容驗證**: Zod Schema 驗證
- **預覽環境**: PR 預覽部署
- **通知系統**: GitHub 原生通知

### 未來擴展路徑

- **後端遷移**: 可無縫遷移到 Payload CMS 或 Strapi
- **API 整合**: 保留現有的服務抽象層
- **資料遷移**: Frontmatter 可直接對應資料庫欄位

## 預估時程

- **階段一**: 3-4 週（Git 工作流程建立）
- **階段二**: 2-3 週（前端系統優化）
- **階段三**: 2 週（測試和文件化）
- **階段四**: 1 週（上線和監控）

**總計**: 8-10 週（約 2-2.5 個月）

## 立即可用的優勢

1. **零基礎設施成本**: 完全基於 GitHub 和現有部署平台
2. **視覺化編輯體驗**: Decap CMS 提供類似 WordPress 的編輯介面
3. **完整審核流程**: GitHub PR 提供完整的審核、討論、版本控制
4. **自動化部署**: 合併 PR 後自動部署到生產環境
5. **開發者友善**: 開發者可直接用 VS Code，內容團隊用 CMS 介面
6. **未來擴展性**: 所有設計都可無痛遷移到完整後端系統

## 工作流程範例

### 使用 Decap CMS 的工作流程：

```
1. 撰寫者登入 /admin CMS 介面
2. 點擊「新增文章」，選擇專科分類
3. 在視覺化編輯器中撰寫內容
4. 設定 status: 'in-review'，點擊「儲存並提交審核」
5. Decap CMS 自動建立 GitHub PR
6. GitHub 自動分配審核者，執行品質檢查
7. 審核者在 PR 中討論和建議修改
8. 所有檢查通過後，管理者合併 PR
9. 自動部署，文章上線
```

### 開發者直接使用 Git 的工作流程：

```
1. 開發者建立分支: feature/cardiology-af-guide
2. 直接編輯 .md 檔案，設定 status: 'draft'
3. 完成後改為 status: 'in-review'，建立 PR
4. 其餘流程與上述相同
```
